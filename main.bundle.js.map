{"version":3,"file":"main.bundle.js","mappings":"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","sources":["webpack://mariosequencer/webpack/runtime/create fake namespace object","webpack://mariosequencer/webpack/runtime/load script","webpack://mariosequencer/./public/image/ sync \\.png$","webpack://mariosequencer/./public/wav/ sync \\.wav$","webpack://mariosequencer/webpack/bootstrap","webpack://mariosequencer/webpack/runtime/define property getters","webpack://mariosequencer/webpack/runtime/ensure chunk","webpack://mariosequencer/webpack/runtime/get javascript chunk filename","webpack://mariosequencer/webpack/runtime/get mini-css chunk filename","webpack://mariosequencer/webpack/runtime/global","webpack://mariosequencer/webpack/runtime/hasOwnProperty shorthand","webpack://mariosequencer/webpack/runtime/make namespace object","webpack://mariosequencer/webpack/runtime/publicPath","webpack://mariosequencer/webpack/runtime/jsonp chunk loading","webpack://mariosequencer/./src/app.types.ts","webpack://mariosequencer/./src/sound.ts","webpack://mariosequencer/./src/timer.ts","webpack://mariosequencer/./src/mario.ts","webpack://mariosequencer/./src/songs.ts","webpack://mariosequencer/./src/eventHandling.ts","webpack://mariosequencer/./src/utils.ts","webpack://mariosequencer/./src/app.module.scss?fc02","webpack://mariosequencer/./src/ui.ts","webpack://mariosequencer/./src/mp3export.ts","webpack://mariosequencer/./src/recorder.ts","webpack://mariosequencer/./src/app.ts"],"sourcesContent":["var getProto = Object.getPrototypeOf ? (obj) => (Object.getPrototypeOf(obj)) : (obj) => (obj.__proto__);\nvar leafPrototypes;\n// create a fake namespace object\n// mode & 1: value is a module id, require it\n// mode & 2: merge all properties of value into the ns\n// mode & 4: return value when already ns object\n// mode & 16: return value when it's Promise-like\n// mode & 8|1: behave like require\n__webpack_require__.t = function(value, mode) {\n\tif(mode & 1) value = this(value);\n\tif(mode & 8) return value;\n\tif(typeof value === 'object' && value) {\n\t\tif((mode & 4) && value.__esModule) return value;\n\t\tif((mode & 16) && typeof value.then === 'function') return value;\n\t}\n\tvar ns = Object.create(null);\n\t__webpack_require__.r(ns);\n\tvar def = {};\n\tleafPrototypes = leafPrototypes || [null, getProto({}), getProto([]), getProto(getProto)];\n\tfor(var current = mode & 2 && value; typeof current == 'object' && !~leafPrototypes.indexOf(current); current = getProto(current)) {\n\t\tObject.getOwnPropertyNames(current).forEach((key) => (def[key] = () => (value[key])));\n\t}\n\tdef['default'] = () => (value);\n\t__webpack_require__.d(ns, def);\n\treturn ns;\n};","var inProgress = {};\nvar dataWebpackPrefix = \"mariosequencer:\";\n// loadScript function to load a script via script tag\n__webpack_require__.l = (url, done, key, chunkId) => {\n\tif(inProgress[url]) { inProgress[url].push(done); return; }\n\tvar script, needAttach;\n\tif(key !== undefined) {\n\t\tvar scripts = document.getElementsByTagName(\"script\");\n\t\tfor(var i = 0; i < scripts.length; i++) {\n\t\t\tvar s = scripts[i];\n\t\t\tif(s.getAttribute(\"src\") == url || s.getAttribute(\"data-webpack\") == dataWebpackPrefix + key) { script = s; break; }\n\t\t}\n\t}\n\tif(!script) {\n\t\tneedAttach = true;\n\t\tscript = document.createElement('script');\n\n\t\tscript.charset = 'utf-8';\n\t\tscript.timeout = 120;\n\t\tif (__webpack_require__.nc) {\n\t\t\tscript.setAttribute(\"nonce\", __webpack_require__.nc);\n\t\t}\n\t\tscript.setAttribute(\"data-webpack\", dataWebpackPrefix + key);\n\t\tscript.src = url;\n\t}\n\tinProgress[url] = [done];\n\tvar onScriptComplete = (prev, event) => {\n\t\t// avoid mem leaks in IE.\n\t\tscript.onerror = script.onload = null;\n\t\tclearTimeout(timeout);\n\t\tvar doneFns = inProgress[url];\n\t\tdelete inProgress[url];\n\t\tscript.parentNode && script.parentNode.removeChild(script);\n\t\tdoneFns && doneFns.forEach((fn) => (fn(event)));\n\t\tif(prev) return prev(event);\n\t}\n\tvar timeout = setTimeout(onScriptComplete.bind(null, undefined, { type: 'timeout', target: script }), 120000);\n\tscript.onerror = onScriptComplete.bind(null, script.onerror);\n\tscript.onload = onScriptComplete.bind(null, script.onload);\n\tneedAttach && document.head.appendChild(script);\n};","var map = {\n\t\"./G_Clef.png\": 2578,\n\t\"./Mario.png\": 9410,\n\t\"./about.png\": 3236,\n\t\"./beat_button.png\": 7997,\n\t\"./bomb.png\": 7712,\n\t\"./character_sheet.png\": 7246,\n\t\"./clear_button.png\": 9179,\n\t\"./end_mark.png\": 3295,\n\t\"./mario_sweat.png\": 6206,\n\t\"./mat.png\": 9113,\n\t\"./numbers.png\": 3944,\n\t\"./play_button.png\": 9890,\n\t\"./repeat_head.png\": 2788,\n\t\"./semitone.png\": 6244,\n\t\"./share.png\": 540,\n\t\"./slider_thumb.png\": 9513,\n\t\"./song_buttons.png\": 1719,\n\t\"./stop_button.png\": 8032,\n\t\"./undo_dog.png\": 3443\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 7502;","var map = {\n\t\"./sound01.wav\": 5372,\n\t\"./sound02.wav\": 2604,\n\t\"./sound03.wav\": 9387,\n\t\"./sound04.wav\": 8111,\n\t\"./sound05.wav\": 7193,\n\t\"./sound06.wav\": 3617,\n\t\"./sound07.wav\": 5684,\n\t\"./sound08.wav\": 9758,\n\t\"./sound09.wav\": 5980,\n\t\"./sound10.wav\": 4730,\n\t\"./sound11.wav\": 3311,\n\t\"./sound12.wav\": 726,\n\t\"./sound13.wav\": 6833,\n\t\"./sound14.wav\": 8784,\n\t\"./sound15.wav\": 1329,\n\t\"./sound16.wav\": 9512,\n\t\"./sound17.wav\": 5640,\n\t\"./sound18.wav\": 9493,\n\t\"./sound19.wav\": 75,\n\t\"./sound20.wav\": 4451,\n\t\"./sound21.wav\": 651,\n\t\"./sound22.wav\": 8899,\n\t\"./sound23.wav\": 3682,\n\t\"./sound24.wav\": 9399,\n\t\"./sound25.wav\": 5292,\n\t\"./sound26.wav\": 4323,\n\t\"./sound27.wav\": 549,\n\t\"./sound28.wav\": 3178,\n\t\"./sound29.wav\": 4813\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 7518;","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n// expose the modules object (__webpack_modules__)\n__webpack_require__.m = __webpack_modules__;\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.f = {};\n// This file contains only the entry chunk.\n// The chunk loading function for additional chunks\n__webpack_require__.e = (chunkId) => {\n\treturn Promise.all(Object.keys(__webpack_require__.f).reduce((promises, key) => {\n\t\t__webpack_require__.f[key](chunkId, promises);\n\t\treturn promises;\n\t}, []));\n};","// This function allow to reference async chunks\n__webpack_require__.u = (chunkId) => {\n\t// return url for filenames based on template\n\treturn \"\" + chunkId + \".bundle.js\";\n};","// This function allow to reference async chunks\n__webpack_require__.miniCssF = (chunkId) => {\n\t// return url for filenames based on template\n\treturn undefined;\n};","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","var scriptUrl;\nif (__webpack_require__.g.importScripts) scriptUrl = __webpack_require__.g.location + \"\";\nvar document = __webpack_require__.g.document;\nif (!scriptUrl && document) {\n\tif (document.currentScript)\n\t\tscriptUrl = document.currentScript.src;\n\tif (!scriptUrl) {\n\t\tvar scripts = document.getElementsByTagName(\"script\");\n\t\tif(scripts.length) scriptUrl = scripts[scripts.length - 1].src\n\t}\n}\n// When supporting browsers where an automatic publicPath is not supported you must specify an output.publicPath manually via configuration\n// or pass an empty string (\"\") and set the __webpack_public_path__ variable from your code to use your own logic.\nif (!scriptUrl) throw new Error(\"Automatic publicPath is not supported in this browser\");\nscriptUrl = scriptUrl.replace(/#.*$/, \"\").replace(/\\?.*$/, \"\").replace(/\\/[^\\/]+$/, \"/\");\n__webpack_require__.p = scriptUrl;","// no baseURI\n\n// object to store loaded and loading chunks\n// undefined = chunk not loaded, null = chunk preloaded/prefetched\n// [resolve, reject, Promise] = chunk loading, 0 = chunk loaded\nvar installedChunks = {\n\t179: 0\n};\n\n__webpack_require__.f.j = (chunkId, promises) => {\n\t\t// JSONP chunk loading for javascript\n\t\tvar installedChunkData = __webpack_require__.o(installedChunks, chunkId) ? installedChunks[chunkId] : undefined;\n\t\tif(installedChunkData !== 0) { // 0 means \"already installed\".\n\n\t\t\t// a Promise means \"currently loading\".\n\t\t\tif(installedChunkData) {\n\t\t\t\tpromises.push(installedChunkData[2]);\n\t\t\t} else {\n\t\t\t\tif(true) { // all chunks have JS\n\t\t\t\t\t// setup Promise in chunk cache\n\t\t\t\t\tvar promise = new Promise((resolve, reject) => (installedChunkData = installedChunks[chunkId] = [resolve, reject]));\n\t\t\t\t\tpromises.push(installedChunkData[2] = promise);\n\n\t\t\t\t\t// start chunk loading\n\t\t\t\t\tvar url = __webpack_require__.p + __webpack_require__.u(chunkId);\n\t\t\t\t\t// create error before stack unwound to get useful stacktrace later\n\t\t\t\t\tvar error = new Error();\n\t\t\t\t\tvar loadingEnded = (event) => {\n\t\t\t\t\t\tif(__webpack_require__.o(installedChunks, chunkId)) {\n\t\t\t\t\t\t\tinstalledChunkData = installedChunks[chunkId];\n\t\t\t\t\t\t\tif(installedChunkData !== 0) installedChunks[chunkId] = undefined;\n\t\t\t\t\t\t\tif(installedChunkData) {\n\t\t\t\t\t\t\t\tvar errorType = event && (event.type === 'load' ? 'missing' : event.type);\n\t\t\t\t\t\t\t\tvar realSrc = event && event.target && event.target.src;\n\t\t\t\t\t\t\t\terror.message = 'Loading chunk ' + chunkId + ' failed.\\n(' + errorType + ': ' + realSrc + ')';\n\t\t\t\t\t\t\t\terror.name = 'ChunkLoadError';\n\t\t\t\t\t\t\t\terror.type = errorType;\n\t\t\t\t\t\t\t\terror.request = realSrc;\n\t\t\t\t\t\t\t\tinstalledChunkData[1](error);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t\t__webpack_require__.l(url, loadingEnded, \"chunk-\" + chunkId, chunkId);\n\t\t\t\t} else installedChunks[chunkId] = 0;\n\t\t\t}\n\t\t}\n};\n\n// no prefetching\n\n// no preloaded\n\n// no HMR\n\n// no HMR manifest\n\n// no on chunks loaded\n\n// install a JSONP callback for chunk loading\nvar webpackJsonpCallback = (parentChunkLoadingFunction, data) => {\n\tvar [chunkIds, moreModules, runtime] = data;\n\t// add \"moreModules\" to the modules object,\n\t// then flag all \"chunkIds\" as loaded and fire callback\n\tvar moduleId, chunkId, i = 0;\n\tif(chunkIds.some((id) => (installedChunks[id] !== 0))) {\n\t\tfor(moduleId in moreModules) {\n\t\t\tif(__webpack_require__.o(moreModules, moduleId)) {\n\t\t\t\t__webpack_require__.m[moduleId] = moreModules[moduleId];\n\t\t\t}\n\t\t}\n\t\tif(runtime) var result = runtime(__webpack_require__);\n\t}\n\tif(parentChunkLoadingFunction) parentChunkLoadingFunction(data);\n\tfor(;i < chunkIds.length; i++) {\n\t\tchunkId = chunkIds[i];\n\t\tif(__webpack_require__.o(installedChunks, chunkId) && installedChunks[chunkId]) {\n\t\t\tinstalledChunks[chunkId][0]();\n\t\t}\n\t\tinstalledChunks[chunkId] = 0;\n\t}\n\n}\n\nvar chunkLoadingGlobal = self[\"webpackChunkmariosequencer\"] = self[\"webpackChunkmariosequencer\"] || [];\nchunkLoadingGlobal.forEach(webpackJsonpCallback.bind(null, 0));\nchunkLoadingGlobal.push = webpackJsonpCallback.bind(null, chunkLoadingGlobal.push.bind(chunkLoadingGlobal));","import { SoundEntity } from \"./sound\";\r\n\r\ntype AppEventMap = DocumentEventMap & {\r\n    \"mp3update\": Mp3UpdateEvent;\r\n}\r\n\r\nexport interface App extends Omit<HTMLElement, \"addEventListener\"> {\r\n    addEventListener: <K extends keyof AppEventMap>(type: K, listener: (ev: AppEventMap[K]) => any, useCapture?: boolean) => any;\r\n}\r\n\r\nexport interface AppButton extends Omit<HTMLButtonElement, \"addEventListener\"> {\r\n    currentFrame: HTMLImageElement;\r\n    images: HTMLImageElement[];\r\n    num: number;\r\n    originalX: number;\r\n    originalY: number;\r\n    originalW: number;\r\n    originalH: number;\r\n    addEventListener: <K extends keyof DocumentEventMap>(type: K, listener: (ev: SequencerBtnEvent) => any, useCapture?: boolean) => any;\r\n    setCurrentFrame: (num: number) => void;\r\n    redraw: () => void;\r\n}\r\n\r\nexport interface ToggleButton extends AppButton {\r\n    reset: () => void;\r\n    set: () => void;\r\n}\r\n\r\nexport interface InstrumentButton extends AppButton {\r\n    se: SoundEntity;\r\n    soundImage: HTMLImageElement;\r\n}\r\n\r\nexport interface BeatButton extends AppButton {\r\n    beats: number;\r\n}\r\n\r\nexport type SequencerButton = AppButton | ToggleButton | InstrumentButton | BeatButton;\r\n\r\nexport interface ISequencerBtnCreationArgs<T extends AppButton> {\r\n    x: number, y: number, w: number, h: number, id: string, images: HTMLImageElement[], clickHandler?: (this: T, ev: SequencerBtnEvent) => any, className?: string\r\n}\r\n\r\nexport interface SequencerBtnEvent extends MouseEvent {\r\n    soundOff?: boolean;\r\n}\r\n\r\nexport interface SequencerSlider extends HTMLInputElement {\r\n    image?: HTMLImageElement; \r\n    originalX: number;\r\n    originalY: number;\r\n    originalW: number;\r\n    originalH: number;\r\n    redraw: () => void;\r\n}\r\n\r\nexport interface IMarioSequencerProps {\r\n    SEMITONERATIO: number;\r\n    MAGNIFY: number;\r\n    CHARSIZE: number;\r\n    HALFCHARSIZE: number;\r\n    ORGWIDTH: number;\r\n    ORGHEIGHT: number;\r\n    SCRHEIGHT: number;\r\n    DEFAULTMAXBARS: number;\r\n    DEFAULTTEMPO: number;\r\n    OFFSETLEFT: number;\r\n    OFFSETTOP: number;\r\n}\r\n\r\nexport interface IMarioSequencerAssets {\r\n    BUTTONS: AppButton[];\r\n    SOUNDS: SoundEntity[];\r\n    /** Stores loaded spritesheets (unscaled) */\r\n    SPRITESHEETS?: {\r\n        Chars: HTMLImageElement;\r\n        Bomb: HTMLImageElement;\r\n        End: HTMLImageElement;\r\n        PlayBtn: HTMLImageElement;\r\n        Repeat: HTMLImageElement;\r\n        Semitone: HTMLImageElement;\r\n        Numbers: HTMLImageElement;\r\n        Stop: HTMLImageElement;\r\n        Beat: HTMLImageElement;\r\n        Song: HTMLImageElement;\r\n        ThumbSlider: HTMLImageElement;\r\n        ClearBtn: HTMLImageElement;\r\n        Mario: HTMLImageElement;\r\n        UndoDog: HTMLImageElement;\r\n    },\r\n    /** Stores scaled sprite frames */\r\n    IMAGES?: {\r\n        Tools: HTMLImageElement[];\r\n        Bomb: HTMLImageElement[];\r\n        GClef: HTMLImageElement;\r\n        Numbers: HTMLImageElement[];\r\n        Mario: HTMLImageElement[];\r\n        Sweat: HTMLImageElement;\r\n        PlayBtn: HTMLImageElement[];\r\n        StopBtn: HTMLImageElement[];\r\n        ClearBtn: HTMLImageElement[];\r\n        ThumbSlider: HTMLImageElement[];\r\n        BeatBtn: HTMLImageElement[];\r\n        SongBtns: HTMLImageElement[];\r\n        EndMarkBtn: HTMLImageElement[];\r\n        EndMark: HTMLImageElement;\r\n        Semitone: HTMLImageElement[];\r\n        Repeat: HTMLImageElement[];\r\n        UndoDog: HTMLImageElement[];\r\n    },\r\n}\r\n\r\nexport enum GameStatus {\r\n    Edit = 0,\r\n    MarioEntering = 1,\r\n    Playing = 2,\r\n    MarioLeaving = 3\r\n}\r\n\r\nexport type MarioSequencerSong = {\r\n    notes: (string|number)[][];\r\n    beats: number;\r\n    loop: boolean;\r\n    end: number;\r\n    tempo: string | number;\r\n}\r\n\r\nexport type MarioSequencerSongCollection = {\r\n    [index: number]: MarioSequencerSong;\r\n}\r\n\r\nexport type MarioSequencerAppState = {\r\n    mouseX: number;\r\n    mouseY: number;\r\n    keyPresses: string[];\r\n\r\n    /** Last ID returned from requestAnimationFrame, can be used to cancel draw callbacks */\r\n    animeId: number;\r\n\r\n    /** Used to prevent animation during resize and redraw of canvas */\r\n    resizing: boolean;\r\n\r\n    /** Stores the Mario Paint composer tool currently selected (index / number) */\r\n    currentTool: number;\r\n\r\n    /** Stores the app's progress/position in relation to the musical score. Used in playback and in rendering the score to the screen. */\r\n    curPos: number;\r\n\r\n    /** When the user loads one of the embedded Mario Paint songs, this is a reference to the associated button in the UI */\r\n    selectedSongBtn?: ToggleButton;\r\n\r\n    /** Stores the current music score state */\r\n    curScore: MarioSequencerSong;\r\n\r\n    /** Stores the music score history - needed for undoDog */\r\n    history: MarioSequencerAppState[];\r\n\r\n    gameStatus: GameStatus;\r\n}\r\n\r\nexport type InstrumentChordRecord = Record<number, number[]>;\r\n\r\ninterface IMp3WorkerUpdateMessage extends Event {\r\n    data : {\r\n        type: \"chordGenUpdate\" | \"songProgressUpdate\";\r\n        value: number;\r\n    }\r\n}\r\n\r\ninterface IMp3WorkerSongMessage extends Event {\r\n    data: {\r\n        type: \"song\";\r\n        value: string;\r\n    }\r\n}\r\n\r\nexport type Mp3UpdateEvent = IMp3WorkerUpdateMessage | IMp3WorkerSongMessage;","import { MarioSequencer } from \"./app\";\r\nimport { IMarioSequencerProps } from \"./app.types\";\r\n\r\ninterface ISoundEntity {\r\n    play(scale: number, delay: number): void;\r\n    playChord(noteList: number[], delay: number): void;\r\n    load(): void;\r\n}\r\n\r\nexport class SoundEntity implements ISoundEntity {\r\n    private AC: AudioContext;\r\n    private app: MarioSequencer;\r\n    private path: string;\r\n    public buffer: AudioBuffer | null;\r\n    private prevChord: any[];\r\n    private diff: number[];\r\n    private settings: IMarioSequencerProps;\r\n    public image: HTMLImageElement | null = null;\r\n    \r\n    constructor(app: MarioSequencer, settings: IMarioSequencerProps, path: string) {\r\n        this.app = app;\r\n        this.AC = app.AC;\r\n        this.path = path;\r\n        this.buffer = null;\r\n        this.prevChord = [];\r\n        this.diff = [14, 12, 11, 9, 7, 6, 4, 2, 0, -1, -3, -5, -6];\r\n        this.settings = settings;\r\n    }\r\n\r\n    /**\r\n     * Plays a note at a given playback rate\r\n     * @param scale Determines the note that will be played\r\n     * @param delay Delay before note is played\r\n     */\r\n    public play(scale: number, delay?: number) {\r\n        var source = this.AC.createBufferSource();\r\n        var tmps = scale & 0x0F;\r\n        var semitone = this.diff[tmps];\r\n        if ((scale & 0x80) != 0) semitone++;\r\n        else if ((scale & 0x40) != 0) semitone--;\r\n        if (delay == undefined) delay = 0;\r\n        source.buffer = this.buffer;\r\n        source.playbackRate.value = Math.pow(this.settings.SEMITONERATIO, semitone);\r\n        source.connect(this.AC.destination);\r\n        if (this.app.MSDestination) source.connect(this.app.MSDestination);\r\n        source.start(delay);\r\n    }\r\n\r\n    /**\r\n     * Play a chord\r\n     * In fact, can be a single note.\r\n     * Purpose is to cancel the sounds in previous bar\r\n     * if the kind of note is the same.\r\n     * Even the chord will be canceled (stoped) playing\r\n     * SNES has channels limit, so that succesive notes\r\n     * cancels previous note when next note comes.\r\n     * Long note like Yoshi can be canceled often\r\n     * BufferSource.stop won't throw an error even if the\r\n     * previous note has already ended.\r\n     * @param noteList \r\n     * @param delay \r\n     */\r\n    public playChord(noteList: number[], delay?: number) {\r\n        // Cancel previous chord first\r\n        for (var i = 0; i < this.prevChord.length; i++) {\r\n            this.prevChord[i].stop();\r\n        }\r\n        this.prevChord = [];\r\n        if (delay == undefined) delay = 0;\r\n        // I heard that Array#map is slower than for loop because of costs of calling methods.\r\n        for (var i = 0; i < noteList.length; i++) {\r\n            var source = this.AC.createBufferSource();\r\n            var scale = (noteList[i] & 0x0F);\r\n            var semitone = this.diff[scale];\r\n            if ((noteList[i] & 0x80) != 0) semitone++;\r\n            else if ((noteList[i] & 0x40) != 0) semitone--;\r\n            source.buffer = this.buffer;\r\n            source.playbackRate.value = Math.pow(this.settings.SEMITONERATIO, semitone);\r\n        \r\n            // Compressor: Suppress harsh distortions\r\n            //var compressor = AC.createDynamicsCompressor();\r\n            //source.connect(compressor);\r\n            //compressor.connect(AC.destination);\r\n            source.connect(this.AC.destination);\r\n            if (this.app.MSDestination) source.connect(this.app.MSDestination);\r\n            source.start(delay);\r\n            this.prevChord.push(source);\r\n        }\r\n    }\r\n\r\n    public load() {\r\n        var filepath = this.path;\r\n        return new Promise<AudioBuffer>((resolve, reject) => {\r\n            // Load buffer asynchronously\r\n            var request = new XMLHttpRequest();\r\n            request.open(\"GET\", filepath, true);\r\n            request.responseType = \"arraybuffer\";\r\n        \r\n            request.onload = () => {\r\n                // Asynchronously decode the audio file data in request.response\r\n                this.AC.decodeAudioData(\r\n                    request.response,\r\n                    function(buffer) {\r\n                        if (!buffer) {\r\n                        reject('error decoding file data: ' + filepath);\r\n                        }\r\n                        resolve(buffer);\r\n                    },\r\n                    function(error) {\r\n                        reject('decodeAudioData error:' + error);\r\n                    }\r\n                );\r\n            };\r\n        \r\n            request.onerror = function() {\r\n                reject('BufferLoader: XHR error');\r\n            };\r\n        \r\n            request.send();\r\n        });\r\n    }\r\n}\r\n\r\nexport class SoundManager {\r\n    private _sequencer: MarioSequencer;\r\n    constructor(sequencer: MarioSequencer) {\r\n        this._sequencer = sequencer;\r\n    }\r\n\r\n    public async loadSounds() {\r\n        const s = this._sequencer;\r\n        const SOUNDS = s.ASSETS.SOUNDS;\r\n        for (let i = 1; i < 21; i++) {\r\n            let tmp = '0';\r\n            tmp += i.toString();\r\n            const file = \"wav/sound\" + tmp.slice(-2) + \".wav\";\r\n            const e = new SoundEntity(this._sequencer, s.CONST, file);\r\n            SOUNDS[i-1] = e;\r\n        }\r\n        await Promise.all(s.ASSETS.SOUNDS.map((s) => s.load())).then((all) => {\r\n            all.map((buffer, i) => {\r\n                s.ASSETS.SOUNDS[i].buffer = buffer;\r\n            });\r\n        });\r\n    }\r\n}","export type EasyTimerFn = (this: EasyTimer) => void;\r\n\r\n/** Timer class that can be used to trigger animations and other effects at a set frequency during \r\n * an animation loop (such as those using requestAnimationFrame) \r\n */\r\nexport class EasyTimer {\r\n    private _frequency: number;\r\n    private _func: EasyTimerFn;\r\n    private _lastTime = 0;\r\n    \r\n    /** Determines whether the timer should execute it's function during animation loop.\r\n     * When set to false, the timer will not execute. \r\n     */\r\n    public switch = false;\r\n    \r\n    /** A reference to the current frame of animation */\r\n    public currentFrame: number = 0;\r\n\r\n    /** A reference to sprite sheet images to be used for this timer */\r\n    public images: HTMLImageElement[] = [];\r\n\r\n    /**\r\n     * Timer class that can be used to trigger animations and other effects at a set frequency during \r\n     * an animation loop (such as those using requestAnimationFrame)\r\n     * @param frequency The frequency at which to fire the timer function (ms)\r\n     * @param func The function that should be fired on a set frequency\r\n     * @param images Spritesheet image array that can be accessed in the timer function\r\n     */\r\n    constructor(frequency: number, func: EasyTimerFn, images?: HTMLImageElement[]) {\r\n        this._frequency = frequency;\r\n        this._func = func;\r\n        if (images) {\r\n            this.images = images;\r\n        }\r\n    }\r\n\r\n    /** Utility function that can be used by animation loops to cause the timer function to fire.\r\n     * When passed a delta time, if enough time has passed (as set by the frequency param in constructor)\r\n     * the function will fire.\r\n     */\r\n    public checkAndFire(time: number) {\r\n        if (this.switch && time - this._lastTime > this._frequency) {\r\n            this._func();\r\n            this._lastTime = time;\r\n        }\r\n    }\r\n}\r\n\r\nexport default EasyTimer;","import { MarioSequencer } from \"./app\";\r\nimport EasyTimer from \"./timer\";\r\n\r\nexport class Mario {\r\n    private offset = -16;\r\n    public scroll = 0;\r\n    public x: number = -16;\r\n    private sweatImage: HTMLImageElement | null = null;\r\n    private spriteImages: HTMLImageElement[] | null = null;\r\n    public pos = 0;\r\n    private start = 0;\r\n    private state = 0;\r\n    private timer?: EasyTimer;\r\n    private mario?: Mario;\r\n    private switch = true; // forever true\r\n    private isJumping = false;\r\n    private lastTime: number = 0;\r\n    private sequencer: MarioSequencer;\r\n\r\n    constructor(sequencerInstance: MarioSequencer) {\r\n        this.sequencer = sequencerInstance;\r\n        if (sequencerInstance.ASSETS.IMAGES) {\r\n            this.spriteImages = sequencerInstance.ASSETS.IMAGES.Mario;\r\n            this.sweatImage = sequencerInstance.ASSETS.IMAGES.Sweat;\r\n        }\r\n        this.init();\r\n    }\r\n\r\n    public init() {\r\n        this.x = -16;\r\n        this.pos = 0;\r\n        this.start = 0;\r\n        this.state = 0;\r\n        this.scroll = 0;\r\n        this.offset = -16;\r\n        const mario = this.mario = this;\r\n        this.timer = new EasyTimer(100, function() {\r\n            mario.state = (mario.state == 1) ? 0 : 1;\r\n        });\r\n        this.timer.switch = true; // forever true;\r\n        this.isJumping = false;\r\n    }\r\n\r\n    public enter(timeStamp: number) {\r\n        if (this.start == 0) this.start = timeStamp;\r\n\r\n        const diff = timeStamp - this.start;\r\n        this.x = Math.floor(diff / 5) + this.offset;\r\n        if (this.x >= 40) this.x = 40; // 16 + 32 - 8\r\n        if (Math.floor(diff / 100) % 2 == 0) {\r\n            this.state = 1;\r\n        } else {\r\n            this.state = 0;\r\n        }\r\n        this.draw();\r\n    }\r\n\r\n    public init4leaving() {\r\n        this.offset = this.x;\r\n        this.start = 0;\r\n        this.isJumping = false;\r\n    }\r\n\r\n    public init4playing(timeStamp: number) {\r\n        this.lastTime = timeStamp;\r\n        this.offset = this.x;\r\n        this.scroll = 0;\r\n        this.pos = 1;\r\n        this.state == 1;\r\n        this._checkMarioShouldJump();\r\n    }\r\n\r\n    private _checkMarioShouldJump() {\r\n        const notes = this.sequencer.appState.curScore.notes[this.pos - 1];\r\n        if (notes == undefined || notes.length == 0) {\r\n            this.isJumping = false;\r\n        } else if (notes.length == 1) {\r\n            this.isJumping = (typeof notes[0] != 'string');\r\n        } else\r\n            this.isJumping = true;\r\n    }\r\n\r\n    public play(timeStamp: number) {\r\n        const { sequencer } = this;\r\n        const tempo = sequencer.appState.curScore.tempo\r\n        if (this.mario) {\r\n            let diff = timeStamp - this.lastTime; // both are [ms]\r\n            if (diff > 32) diff = 16; // When user hide the tag, force it\r\n            this.lastTime = timeStamp;\r\n            const step = 32 * diff * (tempo as number) / 60000; // (60[sec] * 1000)[msec]\r\n    \r\n            this.timer?.checkAndFire(timeStamp);\r\n            const scroll = document.getElementById('scroll') as HTMLInputElement;\r\n    \r\n            var nextBar = (16 + 32 * (this.pos - sequencer.appState.curPos + 1) - 8);\r\n            if (this.mario.x < 120) { // Mario still has to run\r\n                this.x += step;\r\n                // If this step crosses the bar\r\n                if (this.x >= nextBar) {\r\n                    this.pos++;\r\n                    sequencer.scheduleAndPlay(sequencer.appState.curScore.notes[this.pos - 2], 0); // Ignore diff\r\n                    this._checkMarioShouldJump();\r\n                } else {\r\n                    // 32 dots in t[sec/1beat]\r\n                    if (this.x >= 120) {\r\n                        this.scroll = this.x - 120;\r\n                        this.x = 120;\r\n                    }\r\n                }\r\n            } else if (sequencer.appState.curPos <= sequencer.appState.curScore.end - 6) { // Scroll\r\n                this.x = 120;\r\n                if (this.scroll < 16 && (this.scroll + step) > 16) {\r\n                    this.pos++;\r\n                    this.scroll += step;\r\n                    sequencer.scheduleAndPlay(sequencer.appState.curScore.notes[this.pos - 2], 0); // Ignore error\r\n                    this._checkMarioShouldJump();\r\n                } else {\r\n                    this.scroll += step;\r\n                    if (this.scroll > 32) {\r\n                        this.scroll -= 32;\r\n                        sequencer.appState.curPos++;\r\n                        if (scroll) scroll.value = sequencer.appState.curPos.toString();\r\n                        if (sequencer.appState.curPos > (sequencer.appState.curScore.end - 6)) {\r\n                        this.x += this.scroll;\r\n                        this.scroll = 0\r\n                        }\r\n                    }\r\n                }\r\n            } else {\r\n                this.x += step;\r\n                // If this step crosses the bar\r\n                if (this.x >= nextBar) {\r\n                this.pos++;\r\n                sequencer.scheduleAndPlay(sequencer.appState.curScore.notes[this.pos - 2], 0); // Ignore diff\r\n                this._checkMarioShouldJump();\r\n                }\r\n            }\r\n            sequencer.drawScore(sequencer.appState.curPos, sequencer.appState.curScore.notes, this.scroll);\r\n            this.draw();\r\n        }\r\n    }\r\n\r\n    private _jump(x: number) {\r\n        var h = [0, 2, 4, 6, 8, 10, 12, 13, 14, 15, 16, 17, 18, 18, 19, 19, 19,\r\n            19, 19, 18, 18, 17, 16, 15, 14, 13, 12, 10, 8, 6, 4, 2, 0];\r\n        return h[Math.round(x) % 32];\r\n    }\r\n\r\n    public draw() {\r\n        if (this.spriteImages) {\r\n            let y = (41 - 22);\r\n            let state = this.state\r\n            if (this.isJumping) {\r\n                state = 2;\r\n                if (this.x == 120) { // In scroll mode\r\n                // (scroll == 16) is just on the bar, 0 and 32 is on the center of between bars\r\n                if (this.scroll != 16) {\r\n                    y -= this._jump(this.scroll > 16 ? this.scroll - 16 : this.scroll + 16);\r\n                } /* if scroll == 16 then Mario should be on the ground */\r\n                } else { // Running to the center, or leaving to the goal\r\n                y -= this._jump(Math.round((this.x - 8) % 32));\r\n                }\r\n            }\r\n    \r\n            this.sequencer.drawMario(this.spriteImages[state], this.x, y);\r\n        }\r\n    }\r\n\r\n    public leave(timeStamp: number) {\r\n        if (this.sweatImage) {\r\n            if (this.start == 0) this.start = timeStamp;\r\n    \r\n            const diff = timeStamp - this.start;\r\n            if (this.scroll > 0 && this.scroll < 32) {\r\n                this.scroll += Math.floor(diff / 4);\r\n                if (this.scroll > 32) {\r\n                    this.x += this.scroll - 32;\r\n                    this.scroll = 0;\r\n                    this.sequencer.appState.curPos++;\r\n                }\r\n            } else\r\n                this.x = Math.floor(diff / 4) + this.offset;\r\n            if (Math.floor(diff / 100) % 2 == 0) {\r\n                this.state =  8;\r\n                this.draw();\r\n                const w = this.sweatImage.width;\r\n                const h = this.sweatImage.height;\r\n    \r\n                this.sequencer.drawMarioSweat(\r\n                    this.sweatImage,\r\n                    0, 0, w, h,\r\n                    (this.x - (w + 1)), \r\n                    (41 - 22),\r\n                    w, h\r\n                );\r\n                \r\n            } else {\r\n                this.state = 9;\r\n                this.draw();\r\n            }\r\n        }\r\n    }\r\n}","import { MarioSequencerSongCollection } from \"./app.types\";\r\n\r\nconst EmbeddedSongs: MarioSequencerSongCollection = [];\r\nEmbeddedSongs[0] = {\"notes\":[[1026,2313],[1026,2313],[],[1026,2313],\r\n  [],[1028,2315],[1026,2313],[],[1024,2311],[],[],[],[517,3591,265],\r\n  [],[],[],[2818,2820,267],[],[3072,3595],[3072,2818,3595],\r\n  [2817,2820,267],[],[3072,3592],[3072,2817,3591],[2816,2819,267],[],\r\n  [3072,3591],[2816,1287,3595],[2817,1286,1288],[262,1288,1290],\r\n  [1286,3591,1288],[1285,1287,266],[2,3595,3084],[],[256],[257,3595],\r\n  [4,3593,3084],[],[256],[257,7,3593],[6,3592,3084],[4],[256,3592],\r\n  [257,4,3590],[3084],[256],[],[257,6,3591],[7,3084],[3591],\r\n  [256,4,3592],[257],[4,3593,3084],[],[0,3594],[257],[2,3591],[1031],\r\n  [256,1030],[3,1029,3592],[1028],[1027,262],[1026],[1025,263],\r\n  [1026,266,3595],[7],[2050,4],[7,266,3595],[1028,3593,266],[7],\r\n  [2050,4],[5,1031,3593],[1030,3592,266],[1028,6,2568],[4],\r\n  [1,1028,3590],[264],[2049,2,260],[3,260],[261,1030],[1031,266],\r\n  [3584,2,7],[1028],[1,5,7],[1025,3591],[1026],[1027],[],[1028],\r\n  [258,3588],[],[260,3595],[261,3595],[],[261,267],[],[]],\r\n  \"beats\":4,\"loop\":false,\"end\":96,\"tempo\":\"370\"};\r\n\r\nEmbeddedSongs[1] = {\"notes\":[[772,779],[768],[770,779],[768],[772,775],\r\n  [768],[770,775],[768],[772,774],[769],[772,774],[769],[768,770,775],\r\n  [],[],[],[769,774,776],[772],[769,774,776],[772],[770,775,777],\r\n  [772],[770,775,777],[772],[771,773,778],[775],[771,778],[773],\r\n  [771,777,779],[],[],[],[775,777],[768],[775,777],[768],[776,778],\r\n  [768],[776,778],[768],[777,779],[768],[777,779],[768],[778,780],\r\n  [],[],[],[775],[768,772],[775],[768,772],[776],[768,772],[776],\r\n  [768,772],[777],[768,772],[777],[768,772],[771,773,778],[],[],[],\r\n  [777,779],[779],[777,779],[779],[775,777],[777],[775,777],[777],\r\n  [774,776],[776],[774,776],[776],[768,775,777],[],[],[],[774,776],\r\n  [776],[774,776],[773],[772,777],[775],[772,777],[],[771,775,778],\r\n  [],[771,775,778],[],[772,777,779],[],[],[],[]],\r\n  \"beats\":4,\"loop\":true,\"end\":96,\"tempo\":\"178\"};\r\n\r\nEmbeddedSongs[2] = {\"notes\":[[266,3595],[3072,2,7],[3591,3081],[3072,2,7],\r\n  [2305,3590,266],[2305,2,7],[1,2307,3594],[3078],[266,3595],[3072,2,7],\r\n  [3591,3081],[3072,2,7],[2305,3590,266],[2305,3,7],[1,2307,3594],[],\r\n  [1028,3079,3595],[3072,2,7],[1028,3078,3591],[1026,261,7],[1024,267],\r\n  [],[1543],[],[1281,3594],[1,6],[1281,3590],[1282,6],[1283],[],[1798],\r\n  [],[1027,3079,3594],[3072,1,6],[1027,3590,3082],[1025,261,6],[1030,267],\r\n  [],[2055,2059],[],[1280,1285,3595],[2,7],[1280,1285,3591],[1281,2,1286],\r\n  [1282,1287,266],[2571],[],[],[1287,779],[775],[1287,777],[772,1287],\r\n  [1284,775,264],[2306,3077],[2306,264],[2308,3077],[1286,2826],[2822],\r\n  [1286,2824],[2819,1286],[1284,2822,264],[2305,3077],[2305,264],\r\n  [2307,3077],[1285,3335,264],[3331],[1285,3335],[3329,1285],\r\n  [1283,1029,264],[],[519],[],[2304,1282,1028],[2304,1282,1028],\r\n  [2304,1282,1028],[2305,1283,1029],[2306,1284,1030],[],[2304,1282,1028],\r\n  [],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]],\r\n  \"beats\":4,\"loop\":true,\"end\":80,\"tempo\":\"287\"};\r\n\r\n  export default EmbeddedSongs;","import { MarioSequencer } from \"./app\";\r\nimport { GameStatus, SequencerBtnEvent, SequencerButton } from \"./app.types\";\r\n\r\nexport function AddEvents (sequencer: MarioSequencer) {\r\n    sequencer.container.addEventListener(\"playsong\", (e) => {\r\n        const playBtn = document.getElementById(\"play\") as SequencerButton;\r\n        playBtn.style.backgroundImage = \"url(\" + playBtn.images[1].src + \")\";\r\n        playBtn.disabled = true; // Would be unlocked by stop button\r\n        \r\n        const stopBtn = document.getElementById(\"stop\") as SequencerButton;\r\n        stopBtn.style.backgroundImage = \"url(\" + stopBtn.images[0].src + \")\";\r\n        stopBtn.disabled = false;\r\n        \r\n        sequencer.ASSETS.SOUNDS[17].play(8);\r\n\r\n        [\"toLeft\", \"toRight\", \"scroll\", \"clear\", \"frog\", \"beak\", \"1up\"].\r\n            map(function (id) {\r\n                (document.getElementById(id) as HTMLButtonElement).disabled = true;\r\n            });\r\n\r\n        sequencer.appState.gameStatus = GameStatus.MarioEntering; // Mario Entering the stage\r\n        sequencer.appState.curPos = 0;     // doAnimation will draw POS 0 and stop\r\n        sequencer.mario?.init();\r\n        window.requestAnimFrame(sequencer.doMarioEnter);\r\n    });\r\n\r\n    sequencer.container.addEventListener(\"stopsong\", (e) => {\r\n        const stopBtn = document.getElementById(\"stop\") as SequencerButton;\r\n        stopBtn.style.backgroundImage = \"url(\" + stopBtn.images[1].src + \")\";\r\n        stopBtn.disabled = true; // Would be unlocked by play button\r\n\r\n        // Sound ON: click , OFF: called by doMarioPlay\r\n        if (e != undefined) sequencer.ASSETS.SOUNDS[17].play(8);\r\n        const playBtn = document.getElementById(\"play\") as SequencerButton;\r\n        playBtn.style.backgroundImage = \"url(\" + playBtn.images[0].src + \")\";\r\n\r\n        sequencer.appState.gameStatus = GameStatus.MarioLeaving; // Mario leaves from the stage\r\n        sequencer.mario?.init4leaving();\r\n        if (sequencer.appState.animeId != 0) cancelAnimationFrame(sequencer.appState.animeId);\r\n        window.requestAnimFrame(sequencer.doMarioLeave);\r\n    });\r\n}\r\n\r\nexport function EmitClickEvent(b: SequencerButton, soundOff: boolean = false) {\r\n    const e = new Event(\"click\") as SequencerBtnEvent;\r\n    e.soundOff = true;\r\n    b.dispatchEvent(e);\r\n} ","import { MarioSequencer } from \"./app\";\r\nimport { ISequencerBtnCreationArgs, SequencerButton, ToggleButton } from \"./app.types\";\r\nimport { IMarioSequencerProps } from \"./app.types\";\r\n\r\nexport namespace Utils {\r\n\r\n    export function boundFn(sequencer: MarioSequencer, fn: Function) {\r\n        return fn.bind(sequencer);\r\n    }\r\n\r\n    //#region App Constants & Recalculation\r\n\r\n    export function getConstants(this: MarioSequencer, opts: any, container: HTMLElement): IMarioSequencerProps {\r\n        const MAGNIFY = opts.mag || opts.magnify || Utils.getScaledMagnify();\r\n        const CHARSIZE = 16 * MAGNIFY;\r\n        const HALFCHARSIZE = Math.floor(CHARSIZE / 2);\r\n        const ORGHEIGHT = 224;\r\n        const ORGWIDTH = 256;\r\n        container.style.width = ORGWIDTH * MAGNIFY + \"px\";\r\n        container.style.height = ORGHEIGHT * MAGNIFY + \"px\";\r\n        return {\r\n            CHARSIZE,\r\n            DEFAULTMAXBARS: 24 * 4 + 1,\r\n            DEFAULTTEMPO: 100,\r\n            HALFCHARSIZE,\r\n            MAGNIFY,\r\n            ORGHEIGHT,\r\n            ORGWIDTH,\r\n            SCRHEIGHT: 152,\r\n            SEMITONERATIO: Math.pow(2, 1/12),\r\n            OFFSETLEFT: container.offsetLeft,\r\n            OFFSETTOP: container.offsetTop\r\n        }\r\n    }\r\n\r\n    export function getScaledMagnify() {\r\n        const width = Math.floor(window.innerWidth / 256);\r\n        const height = Math.floor((window.innerHeight -84) / 224);\r\n        return Math.min(width, height);\r\n    }\r\n\r\n    //#endregion\r\n\r\n    //#region Button helpers \r\n\r\n    export function createButton(this: MarioSequencer, args: ISequencerBtnCreationArgs<SequencerButton>) {\r\n        const { h, id, images, w, x, y, className, clickHandler } = args;\r\n        const b = document.createElement(\"button\") as SequencerButton;\r\n        b.id = id;\r\n        b.className = \"game\";\r\n        b.style.position = 'absolute';\r\n        this.moveDOM(b, x, y);\r\n        this.resizeDOM(b, w, h);\r\n        b.style.zIndex = \"3\";\r\n        b.style.background = \"rgba(0,0,0,0)\";\r\n    \r\n        // Save position and size for later use\r\n        b.originalX = x;\r\n        b.originalY = y;\r\n        b.originalW = w;\r\n        b.originalH = h;\r\n        b.setCurrentFrame = function (num: number) {\r\n            this.currentFrame = this.images[num];\r\n            this.style.backgroundImage = \"url(\" + this.currentFrame.src + \")\";\r\n        }\r\n        b.redraw = () => {\r\n            this.moveDOM(b, b.originalX, b.originalY);\r\n            this.resizeDOM(b, b.originalW, b.originalH);\r\n            if (b.currentFrame) b.style.backgroundImage = \"url(\" + b.currentFrame.src + \")\";\r\n        }\r\n        if (images) {\r\n            b.images = images;\r\n        }\r\n        if (clickHandler) {\r\n            b.addEventListener(\"click\", clickHandler);\r\n        }\r\n        if (className) {\r\n            b.classList.add(className);\r\n        }\r\n    \r\n        return b;\r\n    }\r\n\r\n    /**\r\n     * Utility function used to ensure that a group of buttons can behave like a choice-group or radio-button selection. \r\n     * When one button is clicked, that button will be disabled and others in the group will be made active. This ensures\r\n     * only one button can be 'selected'.\r\n     * @param buttons An array of buttons that are to behave as a single choice-group\r\n     * @param num The index of the button to which an event handler is being added\r\n     * @param callbackFn The callback function that should execute once button states have been adjusted\r\n     * @returns \r\n     */\r\n    export function createChoiceGroupFunction<T extends SequencerButton>(this: MarioSequencer, buttons: T[], num: number, callbackFn: <CBT extends SequencerButton>(el: (CBT)) => void): (this: HTMLButtonElement, e: MouseEvent) => void {\r\n        const sequencer = this;\r\n\r\n        // Clone the button Array and store reference to the clicked button\r\n        const clone = buttons.slice(0); \r\n        const self = clone[num];\r\n\r\n        // Store a reference to other buttons in the choice group\r\n        clone.splice(num, 1); \r\n        const otherButtons = clone;\r\n\r\n        // When clicked\r\n        return function(this: HTMLButtonElement, e: MouseEvent) {\r\n            const btn = this as T;\r\n\r\n            // Play click sound\r\n            if (!(e as any).soundOff) sequencer.ASSETS.SOUNDS[17].play(8);\r\n            \r\n            // Choice / Option is now selected, so set image and disable button\r\n            this.disabled = true;\r\n            btn.setCurrentFrame(1);\r\n\r\n            // Enable other buttons in group\r\n            otherButtons.map(function (x) {\r\n                x.disabled = false;\r\n                x.setCurrentFrame(0);\r\n            });\r\n\r\n            // Execute callback function\r\n            callbackFn(self);\r\n        };\r\n    }\r\n    \r\n    //#endregion\r\n\r\n    //#region Animation helpers\r\n\r\n    export function showSpriteFrame(btn: SequencerButton, frameLength: number) {\r\n        return function (num: number) {\r\n            return new Promise<void>(function (resolve, reject) {\r\n                setTimeout(function() {\r\n                    btn.style.backgroundImage = \"url(\" + btn.images[num].src + \")\";\r\n                    resolve()\r\n                }, frameLength);\r\n            });\r\n        }\r\n    }\r\n\r\n    //#endregion\r\n\r\n    export async function getImageElFromPath(path: string) {\r\n        return new Promise<HTMLImageElement>((resolve, reject) => {\r\n            const image = new Image();\r\n            image.src = path;\r\n            image.onload = () => {\r\n                resolve(image);\r\n            };\r\n            image.onerror = () => {\r\n                // handle later\r\n            }\r\n        });\r\n    }\r\n\r\n    export function sliceImage(this: MarioSequencer, img: HTMLImageElement, width: number, height: number) {\r\n        const { MAGNIFY } = this.CONST;\r\n        const result: HTMLImageElement[] = [];\r\n        const imgw = img.width * MAGNIFY;\r\n        const imgh = img.height * MAGNIFY;\r\n        const num = Math.floor(img.width / width);\r\n        const all = num * Math.floor(img.height / height);\r\n        const charw = width * MAGNIFY;\r\n        const charh = height * MAGNIFY;\r\n\r\n        for (let i = 0; i < all; i++) {\r\n            const tmpcan = document.createElement(\"canvas\");\r\n            tmpcan.width  = charw;\r\n            tmpcan.height = charh;\r\n            const tmpctx = tmpcan.getContext('2d');\r\n            if (tmpctx) {\r\n                tmpctx.imageSmoothingEnabled = false;\r\n                tmpctx.drawImage(\r\n                    img, \r\n                    (i % num) * width, Math.floor(i / num) * height,\r\n                    width, height, 0, 0, charw, charh\r\n                );\r\n            }\r\n            const charimg = new Image();\r\n            charimg.src = tmpcan.toDataURL();\r\n            result[i] = charimg;\r\n        }\r\n        return result;\r\n    }\r\n\r\n    export function clone(obj: any) {\r\n        return JSON.parse(JSON.stringify(obj));\r\n    }\r\n}\r\n\r\nexport default Utils;","// extracted by mini-css-extract-plugin\nexport default {\"marioSequencer\":\"yTFHQm16Fu2lo5Sqs8iT\",\"mag1x\":\"xTtMW1Psn0SPsihvnKfH\",\"mag2x\":\"OJAprIY_G5RLJjvhPUak\",\"mag3x\":\"WdRzIhUquDXwXynqFgA6\",\"playBtn\":\"U1meHdgWpOA9vU0jbtcL\",\"stopBtn\":\"WYUvtHzL8HX_XQ4oiY2Y\",\"loopBtn\":\"XSIBXVxmBvgSDfKqWxdD\",\"scoreScroll\":\"Cnz701ioK7oELYepSZwB\",\"tempo\":\"keKt_gNCI4vGK7c9kCAx\",\"clearBtn\":\"NttrDqMWvGKnDDI88W9B\"};","import { MarioSequencer } from \"./app\";\r\nimport { \r\n    BeatButton, \r\n    GameStatus, \r\n    InstrumentButton, \r\n    ISequencerBtnCreationArgs, \r\n    MarioSequencerSong, \r\n    SequencerBtnEvent, \r\n    SequencerButton, \r\n    SequencerSlider, \r\n    ToggleButton \r\n} from \"./app.types\";\r\nimport { Mario } from \"./mario\";\r\nimport EmbeddedSongs from \"./songs\";\r\nimport EasyTimer from \"./timer\";\r\nimport { EmitClickEvent } from \"./eventHandling\";\r\nimport Utils from \"./utils\";\r\n\r\nimport styles from \"./app.module.scss\";\r\n\r\nexport namespace UI {\r\n    export class Loader {\r\n        private _sequencer: MarioSequencer;\r\n        \r\n        private _sliceImage: (...args: Parameters<typeof Utils.sliceImage>) => ReturnType<typeof Utils.sliceImage>;\r\n        private _createButton: (...args: Parameters<typeof Utils.createButton>) => ReturnType<typeof Utils.createButton>;\r\n        private _createChoiceGroupFunction: (...args: Parameters<typeof Utils.createChoiceGroupFunction>) => ReturnType<typeof Utils.createChoiceGroupFunction>;\r\n    \r\n        constructor(sequencer: MarioSequencer) {\r\n            this._sequencer = sequencer;\r\n            this._onMouse = this._onMouse.bind(this);\r\n            this._onMouseMove = this._onMouseMove.bind(this);\r\n            this._sliceImage = Utils.boundFn(sequencer, Utils.sliceImage);\r\n            this._createButton = Utils.createButton.bind(sequencer);\r\n            this._createChoiceGroupFunction = Utils.createChoiceGroupFunction.bind(sequencer);\r\n        }\r\n        public async init(reInit?: boolean) {\r\n            // Prepare drawing surfaces / layers\r\n            await this._initLayers();\r\n    \r\n            await this._initImageAssets(reInit);\r\n    \r\n            this._initBomb();\r\n            this._initInstrumentButtons();\r\n            this._initEndMarkButton();\r\n            this._initPlayButton();\r\n            this._initStopButton();\r\n            this._initLoopButton();\r\n            this._initScrollRange();\r\n            this._initBeatButtons();\r\n            this._initSongButtons();\r\n            this._initUndoDog();\r\n            this._initEraserButton();\r\n            this._initTempoRange();\r\n            this._initClearButton();\r\n            this._sequencer.mario = new Mario(this._sequencer);\r\n            \r\n            if (!reInit) {\r\n            \r\n                this._sequencer.initMusicScore();\r\n                this._initScreen();\r\n                this._initKeyboardEventListeners();\r\n                this._initMouseEvents();\r\n    \r\n            } \r\n        }\r\n    \r\n        /** Adds the necessary Canvas layers to the DOM, sizes them appropriately and stores a reference to the 2D Canvas Contexts in the App */\r\n        private async _initLayers() {\r\n            const s = this._sequencer;\r\n            const { MAGNIFY, ORGHEIGHT, ORGWIDTH, SCRHEIGHT } = s.CONST;\r\n            const i = Utils.getImageElFromPath;\r\n    \r\n            // Check specified container has necessary canvas layers, if not create them\r\n            let layer1 = document.querySelector('#layer1') as HTMLCanvasElement;\r\n            let layer2 = document.querySelector('#layer2') as HTMLCanvasElement;\r\n            if (layer1) {\r\n                s.Layer1 = layer1;\r\n            } else {\r\n                layer1 = document.createElement('canvas');\r\n                layer1.id = \"layer1\";\r\n                layer1.classList.add(\"game\");\r\n                s.container.appendChild(layer1);\r\n                s.Layer1 = layer1;\r\n            }\r\n            if (layer2) {\r\n                s.Layer2 = layer2;\r\n            } else {\r\n                layer2 = document.createElement('canvas');\r\n                layer2.id = \"layer2\";\r\n                layer2.classList.add(\"game\");\r\n                s.container.appendChild(layer1);\r\n                s.Layer2 = layer2;\r\n            }\r\n    \r\n            // Store drawing context(s)\r\n            s.L1C = s.Layer1.getContext('2d');\r\n            s.L2C = s.Layer2.getContext('2d');\r\n            \r\n            // Draw background\r\n            s.Layer1.width = ORGWIDTH * MAGNIFY;\r\n            s.Layer1.height = ORGHEIGHT * MAGNIFY;\r\n            s.Layer2.width = ORGWIDTH * MAGNIFY;\r\n            s.Layer2.height = SCRHEIGHT * MAGNIFY;\r\n            if (s.L1C) s.L1C.imageSmoothingEnabled = false;\r\n            if (s.L2C) s.L2C.imageSmoothingEnabled = false;\r\n    \r\n            const bg = await i(\"image/mat.png\");\r\n            if (s.L1C) s.L1C.drawImage(bg, 0, 0, bg.width * MAGNIFY, bg.height * MAGNIFY);       \r\n        }\r\n    \r\n        /** Loads spritesheets so they can be used for image slicing and resize operations */\r\n        private async _loadSpritesheets() {\r\n            const s = this._sequencer;\r\n            const i = Utils.getImageElFromPath;\r\n            const Chars = await i(\"image/character_sheet.png\");\r\n            const Bomb = await i(\"image/bomb.png\");\r\n            const End = await i(\"image/end_mark.png\");\r\n            const PlayBtn = await i(\"image/play_button.png\");\r\n            const Repeat = await i(\"image/repeat_head.png\");\r\n            const Semitone = await i(\"image/semitone.png\");\r\n            const Numbers = await i(\"image/numbers.png\");\r\n            const Stop = await i(\"image/stop_button.png\");\r\n            const Beat = await i(\"image/beat_button.png\");\r\n            const Song = await i(\"image/song_buttons.png\");\r\n            const ThumbSlider = await i(\"image/slider_thumb.png\");\r\n            const ClearBtn = await i(\"image/clear_button.png\");\r\n            const Mario = await i(\"image/Mario.png\");\r\n            const UndoDog = await i(\"image/undo_dog.png\");\r\n            s.ASSETS.SPRITESHEETS = {\r\n                Chars,\r\n                Bomb,\r\n                End,\r\n                PlayBtn,\r\n                Repeat,\r\n                Semitone,\r\n                Numbers,\r\n                Stop,\r\n                Beat,\r\n                Song,\r\n                ThumbSlider,\r\n                ClearBtn,\r\n                Mario,\r\n                UndoDog\r\n            };\r\n        }\r\n    \r\n        /** Loads and stores sprite frames as separate HTMLImageElements. Recalculates on change to Magnify ie. when app is reinitialised */\r\n        private async _initImageAssets(skipLoading?: boolean) {\r\n            const s = this._sequencer;\r\n            if (!skipLoading) {\r\n                await this._loadSpritesheets();\r\n            }\r\n            const { SPRITESHEETS: ss } = s.ASSETS;\r\n            const i = Utils.getImageElFromPath;\r\n            if (ss) {\r\n                const repeatMarks = this._sliceImage(ss.Repeat, 13, 62);\r\n                s.ASSETS.IMAGES = {\r\n                    Tools: this._sliceImage(ss.Chars, 16, 16),\r\n                    Bomb: this._sliceImage(ss.Bomb, 14, 18),\r\n                    GClef: await i(\"image/G_Clef.png\"),\r\n                    Numbers: this._sliceImage(ss.Numbers, 5, 7),\r\n                    Mario: this._sliceImage(ss.Mario, 16, 22),\r\n                    Sweat: await i(\"image/mario_sweat.png\"),\r\n                    PlayBtn: this._sliceImage(ss.PlayBtn, 12, 15),\r\n                    StopBtn: this._sliceImage(ss.Stop, 16, 15),\r\n                    ClearBtn: this._sliceImage(ss.ClearBtn, 34, 16),\r\n                    ThumbSlider: this._sliceImage(ss.ThumbSlider, 5, 8),\r\n                    BeatBtn: this._sliceImage(ss.Beat, 14, 15),\r\n                    SongBtns: this._sliceImage(ss.Song, 15, 17),\r\n                    EndMarkBtn: this._sliceImage(ss.End, 14, 13), // Note: Different size from the button,\r\n                    EndMark: repeatMarks[2],\r\n                    Semitone: this._sliceImage(ss.Semitone, 5, 12),\r\n                    Repeat: repeatMarks,\r\n                    UndoDog: this._sliceImage(ss.UndoDog, 14, 15),\r\n                };\r\n            }\r\n        }\r\n    \r\n        /** Initialises the bomb icon. In the original Mario Paint, this button was how you exited the game's different modes\r\n         * like the music composer and stamp editor. It isn't functional in this app, but we animate it all the same...\r\n         */\r\n        private _initBomb() {\r\n            const s = this._sequencer;\r\n            const { MAGNIFY } = s.CONST;\r\n            const { IMAGES } = s.ASSETS;\r\n            if (IMAGES && s.L1C) {\r\n                s.TIMERS.bomb = new EasyTimer(150, function() {\r\n                    const x = 9 * MAGNIFY;\r\n                    const y = 202 * MAGNIFY;\r\n                    const img = IMAGES.Bomb[this.currentFrame];\r\n                    if (s.L1C) s.L1C.drawImage(img, x, y);\r\n                    switch (this.currentFrame) {\r\n                        case 0:\r\n                            this.currentFrame = 1;\r\n                            break;\r\n                        case 1:\r\n                            this.currentFrame = 0;\r\n                            break;\r\n                        case 2:\r\n                            break;\r\n                    }\r\n                    if (s.appState.selectedSongBtn == undefined || s.appState.gameStatus != GameStatus.Playing) return;\r\n                    s.appState.selectedSongBtn.style.backgroundImage =\r\n                        \"url(\" + s.appState.selectedSongBtn.images[this.currentFrame + 1].src + \")\";\r\n                });\r\n                s.TIMERS.bomb.switch = true; // always true for the bomb\r\n                s.TIMERS.bomb.currentFrame = 0;\r\n            }\r\n        }\r\n    \r\n        /** Initialises the various instrument icon buttons that line the top of the screen */\r\n        private _initInstrumentButtons() {\r\n            const s = this._sequencer;\r\n            const ui = this;\r\n            const { BUTTONS, SOUNDS, IMAGES } = s.ASSETS;\r\n            if (IMAGES) {\r\n                // Make buttons for changing a kind of notes.\r\n                //   1st mario:   x=24, y=8, width=13, height=14\r\n                //   2nd Kinopio: X=38, y=8, width=13, height=14\r\n                //   and so on...\r\n                const bimgs = IMAGES.Tools;\r\n                for (let i = 0; i < 15; i++) {\r\n                    const b = this._getOrCreateButton((24 + 14 * i), 8, 13, 14, 'instr_' + i, [bimgs[i]], () => {\r\n                        b.se.play(8); // Note F\r\n                        s.setState({\r\n                            currentTool: b.num\r\n                        });\r\n                        ui._clearEraserButton();\r\n                        ui.changeCursor(b.num);\r\n                        if (b.se.image) ui._drawCurChar(b.se.image);\r\n                    }) as InstrumentButton;\r\n                    b.num = i;\r\n                    b.se = SOUNDS[i];\r\n                    b.se.image = bimgs[i];\r\n                    BUTTONS[i] = b;\r\n                }\r\n            }\r\n        }\r\n    \r\n        private _initEndMarkButton() {\r\n            const s = this._sequencer;\r\n            const ui = this;\r\n            const { MAGNIFY } = s.CONST;\r\n            const { IMAGES } = s.ASSETS;\r\n            if (IMAGES) {\r\n                const b = this._getOrCreateButton(235, 8, 13, 14, 'endmark', IMAGES.EndMarkBtn, () => {\r\n                    s.TIMERS.endMark.switch = true;\r\n                    s.setState({\r\n                        currentTool: 15\r\n                    });\r\n                    s.ASSETS.SOUNDS[15].play(8);\r\n                    ui._clearEraserButton();\r\n                    s.drawEndMarkIcon(b.images[0]);\r\n                });\r\n                b.images = IMAGES.EndMarkBtn;\r\n                \r\n                // Setup flashing end-bar cursor that displays when end mark button is selected\r\n                s.TIMERS.endMark = new EasyTimer(150, function () {\r\n                    // If current instrument/selected-button is not end mark, just return;\r\n                    if (s.appState.currentTool != 15) {\r\n                        this.switch = false;\r\n                        return;\r\n                    }\r\n                    // alternate frames\r\n                    this.currentFrame = (this.currentFrame == 0) ? 1 : 0;\r\n                    if (s.Layer2) s.Layer2.style.cursor = 'url(' + this.images[this.currentFrame].src + ')' +\r\n                    7 * MAGNIFY +' '+ 7 * MAGNIFY + ', auto';\r\n                }, b.images);\r\n    \r\n                s.ASSETS.BUTTONS[15] = b;\r\n            }\r\n        }\r\n    \r\n        private _initPlayButton() {\r\n            const s = this._sequencer;\r\n            const { IMAGES } = s.ASSETS;\r\n            if (IMAGES) {\r\n                const b = this._getOrCreateButton(55, 168, 12, 15, 'play', IMAGES.PlayBtn, function (this: SequencerButton, e: MouseEvent) {\r\n                    const play = new Event(\"playsong\", { bubbles: true });\r\n                    this.dispatchEvent(play);\r\n                }, styles.playBtn);\r\n                b.setCurrentFrame(0);\r\n            }\r\n        }\r\n    \r\n        private _initStopButton() {\r\n            const s = this._sequencer;\r\n            const { IMAGES } = s.ASSETS;\r\n            if (IMAGES) {\r\n                const imgs = IMAGES.StopBtn;\r\n                const b = this._getOrCreateButton(21, 168, 16, 15, 'stop', [imgs[0], imgs[1]], function (this: SequencerButton, e: MouseEvent) {\r\n                    const stop = new Event(\"stopsong\", { bubbles: true });\r\n                    this.dispatchEvent(stop);\r\n                }, styles.stopBtn);\r\n                b.disabled = false;\r\n                b.setCurrentFrame(1);\r\n            }\r\n        }\r\n    \r\n        private _initLoopButton() {\r\n            const s = this._sequencer;\r\n            const { appState } = s;\r\n            const { IMAGES } = s.ASSETS;\r\n            const sequencer = this;\r\n            if (IMAGES) {\r\n                const imgs = IMAGES.StopBtn;\r\n                const b = this._getOrCreateButton(85, 168, 16, 15, 'loop', [imgs[2], imgs[3]], function(e) {\r\n                    let loop = true;\r\n                    if (s.appState.curScore.loop) {\r\n                        loop = false;\r\n                    }\r\n                    let num = loop ? 1 : 0;\r\n                    s.setState({\r\n                        ...appState,\r\n                        curScore: {\r\n                            ...appState.curScore,\r\n                            loop\r\n                        }\r\n                    });\r\n                    this.setCurrentFrame(num);\r\n                    s.ASSETS.SOUNDS[17].play(8);\r\n                }, styles.loopBtn) as ToggleButton;\r\n                b.setCurrentFrame(0);\r\n                s.appState.curScore.loop = false;\r\n                b.reset = function () {\r\n                    s.appState.curScore.loop = false;\r\n                    this.setCurrentFrame(0);\r\n                };\r\n                b.set   = function () {\r\n                    s.appState.curScore.loop = true;\r\n                    this.setCurrentFrame(1);\r\n                }\r\n            }\r\n        }\r\n    \r\n        private _initScrollRange() {\r\n            const s = this._sequencer;\r\n            const { MAGNIFY } = s.CONST;\r\n            let r = document.getElementById('scroll') as SequencerSlider;\r\n            if (r === null) {\r\n                r = document.createElement('input') as SequencerSlider;\r\n                r.id = 'scroll';\r\n                r.classList.add(styles.scoreScroll);\r\n                r.type = 'range';\r\n                r.value = \"0\";\r\n                r.max = (s.curMaxBars - 6).toString();\r\n                r.min = \"0\";\r\n                r.step = \"0.2\";\r\n                (r.style as any)['-webkit-appearance']='none';\r\n                (r.style as any)['border-radius'] = '0px';\r\n                (r.style as any)['background-color'] = '#F8F8F8';\r\n                (r.style as any)['box-shadow'] = 'inset 0 0 0 #000';\r\n                (r.style as any)['vertical-align'] = 'middle';\r\n                r.style.position = 'absolute';\r\n                r.style.margin = \"0\";\r\n                r.originalX = 191;\r\n                r.originalY = 159;\r\n                r.originalW = 50;\r\n                r.originalH = 7;\r\n                s.moveDOM(r, r.originalX, r.originalY);\r\n                s.resizeDOM(r, r.originalW, r.originalH);\r\n                r.redraw = () => {\r\n                    s.moveDOM(r, r.originalX, r.originalY);\r\n                    s.resizeDOM(r, r.originalW, r.originalH);\r\n                };\r\n                r.addEventListener(\"input\", function(this: SequencerSlider, e: Event) {\r\n                    s.appState.curPos = parseInt(this.value);\r\n                });\r\n                if (s.Layer2) {\r\n                    s.Layer2.addEventListener(\"wheel\", (e) => {\r\n                        if (e.deltaY < 0) {\r\n                            r.valueAsNumber += 0.2;\r\n                        } else {\r\n                            r.valueAsNumber -= 0.2;\r\n                        }\r\n                        let event = new Event('input', {bubbles: true, cancelable: true});\r\n                        r.dispatchEvent(event);\r\n                        e.preventDefault();\r\n                        e.stopPropagation();\r\n                    });\r\n                }\r\n                s.container.appendChild(r);\r\n            }\r\n        }\r\n    \r\n        private _initBeatButtons() {\r\n            const s = this._sequencer;\r\n            const createChoiceGroup = this._createChoiceGroupFunction.bind(s);\r\n            const { IMAGES } = s.ASSETS;\r\n            if (IMAGES) {\r\n                const imgs = IMAGES.BeatBtn;\r\n                const b1 = this._getOrCreateButton(81, 203, 14, 15, '3beats', [imgs[0], imgs[1]]) as BeatButton;\r\n                b1.beats = 3;\r\n                b1.setCurrentFrame(0);\r\n                b1.disabled = false;\r\n                \r\n                const b2 = this._getOrCreateButton(96, 203, 14, 15, '4beats', [imgs[2], imgs[3]]) as BeatButton;\r\n                b2.beats = 4;\r\n                b2.setCurrentFrame(1);\r\n                b2.disabled = true;\r\n                \r\n                const func = function(self: SequencerButton) {\r\n                    const { appState } = s;\r\n                    s.setState({\r\n                        ...appState,\r\n                        curScore: {\r\n                            ...appState.curScore,\r\n                            beats: (self as BeatButton).beats\r\n                        }\r\n                    });\r\n                };\r\n                \r\n                b2.addEventListener(\"click\", this._createChoiceGroupFunction([b1, b2], 1, func));\r\n                b1.addEventListener(\"click\", this._createChoiceGroupFunction([b1, b2], 0, func));\r\n            }\r\n        }\r\n    \r\n        private _initSongButtons() {\r\n            const s = this._sequencer;\r\n            const ui = this;\r\n            const { IMAGES } = s.ASSETS;\r\n            if (IMAGES) {\r\n                const imgs = IMAGES.SongBtns;\r\n    \r\n                // Create buttons\r\n                const songButtons = ['frog','beak','1up'].map(function (id, idx) {\r\n                    const b = ui._getOrCreateButton(136 + 24 * idx, 202, 15, 17, id, imgs.slice(idx * 3, idx * 3 + 3)) as ToggleButton;\r\n                    b.id = id;\r\n                    b.num = idx;\r\n                    b.setCurrentFrame(0);\r\n                    b.disabled = false;\r\n                    return b;\r\n                });\r\n    \r\n                // Callback function that loads an appropriate embedded song in to memory and reinitialises various properties\r\n                const callbackFunc = function (self: SequencerButton) {\r\n                    const { appState } = s;\r\n                    const curScore: MarioSequencerSong = Utils.clone(EmbeddedSongs[self.num]);\r\n                    const tempoEl = document.getElementById(\"tempo\") as HTMLInputElement;\r\n                    if (tempoEl) tempoEl.value = curScore.tempo.toString();\r\n                    const b = document.getElementById(\"loop\") as ToggleButton;\r\n                    if (curScore.loop) b.set(); else b.reset();\r\n                    const scr = document.getElementById(\"scroll\") as HTMLInputElement;\r\n                    scr.max = (curScore.end - 5).toString();\r\n                    scr.value = \"0\";\r\n                    \r\n                    s.setState({\r\n                        curScore,\r\n                        curPos: 0,\r\n                        selectedSongBtn: self as ToggleButton,\r\n                    });\r\n                    s.drawScore(s.appState.curPos, s.appState.curScore['notes'], 0);\r\n                };\r\n    \r\n                // Attach choice group event handler to each song button\r\n                songButtons.forEach((btn, idx) => {\r\n                    songButtons[idx].addEventListener(\"click\", this._createChoiceGroupFunction(songButtons, idx, callbackFunc));\r\n                });\r\n            }\r\n        }\r\n    \r\n        private _initUndoDog() {\r\n            const s = this._sequencer;\r\n            const ui = this;\r\n            const { IMAGES } = s.ASSETS;\r\n            if (IMAGES) {\r\n                const b = this._getOrCreateButton(216, 203, 14, 15, 'undoDog', IMAGES.UndoDog, async function () {\r\n                    if (s.appState.gameStatus === GameStatus.Edit) {\r\n                        s.ASSETS.SOUNDS[18].play(8);\r\n                        const frame = Utils.showSpriteFrame(this, 150);\r\n                        await frame(1);\r\n                        await frame(0);\r\n        \r\n                        const previousState = s.appState.history.pop();\r\n                        let changeCursor = previousState && s.appState.currentTool !== previousState.currentTool;\r\n                        let changeSongBtn = previousState && previousState.selectedSongBtn !== s.appState.selectedSongBtn;\r\n                        let changeBeat = previousState && previousState.curScore.beats !== s.appState.curScore.beats;\r\n                        if (previousState) {\r\n                            s.appState = previousState;\r\n                        } \r\n                        if (changeCursor) {\r\n                            ui.changeCursor(s.appState.currentTool);\r\n                        }\r\n                        if (changeSongBtn) {\r\n                            ['frog','beak','1up'].forEach(function (id, idx) {\r\n                                const b = document.getElementById(id) as ToggleButton;\r\n                                b.setCurrentFrame(0);\r\n                                b.disabled = false;\r\n                            });\r\n                            if (s.appState.selectedSongBtn) {\r\n                                s.appState.selectedSongBtn.setCurrentFrame(1);\r\n                                s.appState.selectedSongBtn.disabled = true;\r\n                            }\r\n                        }\r\n                        if (changeBeat) {\r\n                            ['3beats', '4beats'].forEach(function (id, idx) {\r\n                                const b = document.getElementById(id) as BeatButton;\r\n                                const isSelected = b.beats === s.appState.curScore.beats; \r\n                                b.setCurrentFrame(isSelected ? 1 : 0);\r\n                                b.disabled = isSelected;\r\n                            })\r\n                        }\r\n                        s.drawScore(s.appState.curPos, s.appState.curScore.notes, s.appState.curPos);\r\n                    }\r\n                });\r\n                b.setCurrentFrame(0);\r\n            }\r\n        }\r\n    \r\n        private _initEraserButton() {\r\n            const s = this._sequencer;\r\n            const ui = this;\r\n            const { IMAGES } = s.ASSETS;\r\n            if (IMAGES) {\r\n                const imgs = IMAGES.SongBtns;\r\n                const b = this._getOrCreateButton(40, 202, 15, 17, 'eraser', [imgs[9], imgs[10], imgs[11]], function() {\r\n                    const btn = this as SequencerButton;\r\n                    s.TIMERS.eraser.switch = true;\r\n                    s.setState({currentTool: 16});\r\n                    s.ASSETS.SOUNDS[17].play(8);\r\n                    s.drawEraserIcon();\r\n                    ui._clearSongButtons();\r\n                    btn.setCurrentFrame(1);\r\n                    if (s.Layer2) s.Layer2.style.cursor = 'url(' + btn.images[2].src + ')' + ' 0 0, auto';\r\n                }) as SequencerButton;\r\n                b.setCurrentFrame(0);\r\n                s.TIMERS.eraser = new EasyTimer(200, function () {\r\n                    // If current is not end mark, just return;\r\n                    if (s.appState.currentTool != 16) {\r\n                    this.switch = false;\r\n                    return;\r\n                    }\r\n                    this.currentFrame = (this.currentFrame == 0) ? 1 : 0;\r\n                });\r\n                s.TIMERS.eraser.currentFrame = 0;\r\n            }\r\n        }\r\n    \r\n        private _initTempoRange() {\r\n            const s = this._sequencer;\r\n            const { IMAGES } = s.ASSETS;\r\n            if (IMAGES) {\r\n                const setThumbImage = (range: SequencerSlider) => {\r\n                    const t = IMAGES.ThumbSlider[0];\r\n                    range.image = t;\r\n                    const seqEl = document.querySelector(`.${styles.marioSequencer}`) as HTMLElement;\r\n                    if (seqEl) {\r\n                        seqEl.style.setProperty('--tempoThumbImg', `url('${t.src}')`);\r\n                    }\r\n                };\r\n    \r\n                let r = document.getElementById('tempo') as SequencerSlider;\r\n                if (r === null) {\r\n                    r = document.createElement('input') as SequencerSlider;\r\n                    r.id = \"tempo\";\r\n                    r.classList.add(styles.tempo);\r\n                    r.type = \"range\";\r\n                    r.value = \"525\";\r\n                    r.max = \"1000\";\r\n                    r.min = \"50\";\r\n                    r.step = \"1\";\r\n                    (r.style as any)['-webkit-appearance']='none';\r\n                    (r.style as any)['border-radius'] = '0px';\r\n                    (r.style as any)['background-color'] = 'rgba(0, 0, 0, 0.0)';\r\n                    (r.style as any)['box-shadow'] = 'inset 0 0 0 #000';\r\n                    (r.style as any)['vertical-align'] = 'middle';\r\n                    r.style.position = \"absolute\";\r\n                    r.style.margin = \"0\";\r\n                    r.originalX = 116;\r\n                    r.originalY = 172;\r\n                    r.originalW = 40;\r\n                    r.originalH = 8;\r\n                    s.moveDOM(r, r.originalX, r.originalY);\r\n                    s.resizeDOM(r, r.originalW, r.originalH);\r\n                    r.redraw = () => {\r\n                        s.moveDOM(r, r.originalX, r.originalY);\r\n                        s.resizeDOM(r, r.originalW, r.originalH);\r\n                        setThumbImage(r);\r\n                    };\r\n                    r.addEventListener(\"input\", function(e) {\r\n                        s.appState.curScore.tempo = parseInt(this.value);\r\n                    });\r\n                    r.addEventListener(\"mouseup\", function(e) {\r\n                        const { appState } = s;\r\n                        s.setState({\r\n                            curScore: {\r\n                                ...appState.curScore,\r\n                                tempo: parseInt(this.value)\r\n                            }\r\n                        });\r\n                    })\r\n                    s.container.appendChild(r);\r\n                    setThumbImage(r);\r\n                }\r\n        \r\n                // Prepare range's side buttons for inc/decrements\r\n                const bLeft = this._getOrCreateButton(184, 158, 7, 9, 'toLeft', [], function (e) {\r\n                    const r = document.getElementById('scroll') as HTMLInputElement;\r\n                    let val = parseInt(r.value, 10);\r\n                    if (val > 0) {\r\n                        s.appState.curPos = --val;\r\n                    }\r\n                });\r\n        \r\n                const bRight = this._getOrCreateButton(241, 158, 7, 9, 'toRight', [], function (e) {\r\n                    const r = document.getElementById('scroll') as HTMLInputElement;\r\n                    let val = parseInt(r.value, 10);\r\n                    if (val < s.curMaxBars - 6) {\r\n                        s.appState.curPos = ++val;\r\n                    }\r\n                });\r\n            }\r\n        }\r\n    \r\n        private _initClearButton() {\r\n            const s = this._sequencer;\r\n            const ui = this;\r\n            const { IMAGES } = s.ASSETS;\r\n            if (IMAGES) {\r\n                const b = this._getOrCreateButton(200, 176, 34, 16, 'clear', IMAGES.ClearBtn, async function (this: SequencerButton, e: MouseEvent) {\r\n                    this.style.backgroundImage = \"url(\" + this.images[1].src + \")\";\r\n                    s.ASSETS.SOUNDS[19].play(8);\r\n                    const btn = this;\r\n                    const frame = Utils.showSpriteFrame(btn, 150);\r\n                    await frame(2);\r\n                    await frame(1);\r\n                    await frame(0);\r\n                    s.initMusicScore();\r\n                    s.appState.curPos = 0;\r\n                    ui._clearSongButtons();\r\n                }, styles.clearBtn);\r\n                b.setCurrentFrame(0);\r\n            }\r\n        }\r\n\r\n        private _reInitButtonsFromScore() {\r\n            const s = this._sequencer;\r\n            const b = document.getElementById(s.appState.curScore.beats == 3 ? '3beats' : '4beats') as SequencerButton;\r\n            EmitClickEvent(b, true);\r\n\r\n            const r = document.getElementById('scroll') as HTMLInputElement;\r\n            s.curMaxBars = s.appState.curScore.end + 1;\r\n            r.max = (s.curMaxBars - 6).toString();\r\n            r.value = \"0\";\r\n            s.appState.curPos = 0;\r\n\r\n            const tempoRange = document.getElementById(\"tempo\") as HTMLInputElement;\r\n            let tempo = s.appState.curScore.notes[0][0];\r\n            if (typeof tempo == \"string\" && tempo.substr(0, 5) == \"TEMPO\") {\r\n                tempo = tempo.split(\"=\")[1];\r\n                s.appState.curScore.tempo = tempo;\r\n                tempoRange.value = tempo;\r\n            }\r\n        }\r\n\r\n        private _initScreen() {\r\n            const s = this._sequencer;\r\n            const { SOUNDS } = s.ASSETS;\r\n            s.appState.curPos = 0;\r\n            s.appState.currentTool = 0;\r\n            const img = SOUNDS[s.appState.currentTool].image;\r\n            if (img) {\r\n                this._drawCurChar(img);\r\n            }\r\n            this.changeCursor(s.appState.currentTool);\r\n            s.drawScore(s.appState.curPos, s.appState.curScore['notes'], 0);\r\n            window.requestAnimFrame(s.doAnimation);\r\n        }\r\n\r\n        private _initMouseEvents() {\r\n            const s = this._sequencer;\r\n            if (s.Layer2) {\r\n                s.Layer2.addEventListener(\"contextmenu\", this._onMouse);\r\n                s.Layer2.addEventListener(\"click\", this._onMouse);\r\n                s.Layer2.addEventListener(\"mousemove\", this._onMouseMove);\r\n                s.Layer2.addEventListener(\"dragover\", (e) => {\r\n                    e.preventDefault();\r\n                    return false;\r\n                });\r\n                s.Layer2.addEventListener(\"drop\", this._readDroppedFiles);\r\n            }\r\n        }\r\n\r\n        public changeCursor(num: number) {\r\n            const s = this._sequencer;\r\n            const { HALFCHARSIZE } = s.CONST;\r\n            const { SOUNDS } = s.ASSETS;\r\n            const SCREEN = s.Layer2;\r\n            const img = SOUNDS[num].image;\r\n            if (SCREEN && img) {\r\n                SCREEN.style.cursor = 'url(' + img.src + ')' + HALFCHARSIZE +' '+ HALFCHARSIZE + ', auto';\r\n            }\r\n        }\r\n    \r\n        private _drawCurChar(image: HTMLImageElement) {\r\n            const s = this._sequencer;\r\n            const { CHARSIZE, MAGNIFY } = s.CONST;\r\n            const x = 4 * MAGNIFY;\r\n            const y = 7 * MAGNIFY;\r\n            if (s.L1C) {\r\n                s.L1C.beginPath();\r\n                s.L1C.imageSmoothingEnabled = false;\r\n                s.L1C.clearRect(x, y, CHARSIZE, CHARSIZE);\r\n                s.L1C.drawImage(image, x, y);\r\n                s.L1C.fillRect(x, y, CHARSIZE, MAGNIFY);\r\n                s.L1C.fillRect(x, y + CHARSIZE - MAGNIFY, CHARSIZE, MAGNIFY);\r\n            }\r\n        }\r\n\r\n        //#region clear button functions\r\n\r\n        private _clearEraserButton() {\r\n            const s = this._sequencer;\r\n            const b = document.getElementById('eraser') as SequencerButton;\r\n            b.style.backgroundImage = \"url(\" + b.images[0].src + \")\";\r\n            s.TIMERS.eraser.switch = false;\r\n        }\r\n\r\n        private _clearSongButtons() {\r\n            const s = this._sequencer;\r\n            ['frog','beak','1up'].map(function (id, idx) {\r\n                const b = document.getElementById(id) as SequencerButton;\r\n                b.disabled = false;\r\n                b.style.backgroundImage = \"url(\" + b.images[0].src + \")\";\r\n            });\r\n            s.appState.selectedSongBtn = undefined;\r\n        }\r\n\r\n        //#endregion\r\n\r\n        //#region mouse event listeners \r\n\r\n        private _onMouse(e: MouseEvent) {\r\n            const s = this._sequencer;\r\n            e.preventDefault();\r\n            if (e.type === \"contextmenu\") {\r\n                document.getElementById('undoDog')?.click();\r\n                return;\r\n            }\r\n\r\n            const { OFFSETLEFT, OFFSETTOP } = s.CONST;\r\n            const { SOUNDS } = s.ASSETS;\r\n            if (s.appState.gameStatus != GameStatus.Edit) return;\r\n\r\n            const realX = e.clientX - OFFSETLEFT;\r\n            const realY = e.clientY - OFFSETTOP;\r\n\r\n            const g = this.toGrid(realX, realY);\r\n            if (g == false) return;\r\n            const gridX = g[0];\r\n            let gridY = g[1];\r\n\r\n            // Map logical x to real bar number\r\n            const b = s.appState.curPos + gridX - 2;\r\n\r\n            // process End Mark\r\n            if (s.appState.currentTool == 15) {\r\n                s.updateHistory();\r\n                s.appState.curScore.end = b;\r\n                return;\r\n            }\r\n\r\n            if (b >= s.appState.curScore.end) return;\r\n\r\n            const allNotes = [...s.appState.curScore['notes']];\r\n            const notes = [...allNotes[b]];\r\n            // Delete\r\n            if (s.appState.currentTool == 16 || e.button == 2) {\r\n                // Delete Top of the stack\r\n                s.updateHistory();\r\n                for (let i = notes.length - 1; i >= 0; i--) {\r\n                if ((notes[i] as number & 0x3F) == gridY) {\r\n                    notes.splice(i, 1);\r\n                    s.appState.curScore.notes[b] = notes;\r\n                    SOUNDS[17].play(8);\r\n                    break;\r\n                }\r\n                }\r\n                return;\r\n            }\r\n\r\n            // Ignore if note already added\r\n            let note = (s.appState.currentTool << 8) | gridY;\r\n            if (notes.indexOf(note) != -1) return;\r\n            \r\n            // Handle semitone\r\n            if (e.shiftKey) gridY |= 0x80;\r\n            if (e.ctrlKey ) gridY |= 0x40;\r\n            SOUNDS[s.appState.currentTool].play(gridY);\r\n            note = (s.appState.currentTool << 8) | gridY;\r\n            notes.push(note);\r\n            allNotes[b] = notes;\r\n            s.setState({\r\n                curScore: {\r\n                    ...s.appState.curScore,\r\n                    notes: allNotes\r\n                }\r\n            });\r\n        }\r\n\r\n        private _onMouseMove(e: MouseEvent) {\r\n            const s = this._sequencer;\r\n            s.appState.mouseX = e.clientX;\r\n            s.appState.mouseY = e.clientY;\r\n        }\r\n\r\n        private _readDroppedFiles(e: DragEvent) {\r\n            const s = this._sequencer;\r\n            e.preventDefault();\r\n            this._clearSongButtons();\r\n            s.resetScore();\r\n            // function to read a given file\r\n            // Input is a instance of a File object.\r\n            // Returns a instance of a Promise.\r\n            function readFile(file: File) {\r\n                return new Promise<FileReader|null>(function(resolve, reject) {\r\n                    var reader = new FileReader();\r\n                    (reader as any).name = file.name;\r\n                    reader.addEventListener(\"load\", function(e) {\r\n                        resolve(e.target);\r\n                    });\r\n                    reader.readAsText(file, 'shift-jis');\r\n                });\r\n            }\r\n\r\n            if (e.dataTransfer) {\r\n                // FileList to Array for Mapping\r\n                var files = [].slice.call(e.dataTransfer.files);\r\n                // Support Mr.Phenix's files. He numbered files with decimal numbers :-)\r\n                // http://music.geocities.jp/msq_phenix/\r\n                // For example, suite15.5.msq must be after the suite15.msq\r\n                files.sort(function(a: File,b: File) {\r\n                    var n1 = a.name;\r\n                    var n2 = b.name;\r\n                    function strip(name: string) {\r\n                        let n = /\\d+\\.\\d+|\\d+/.exec(name);\r\n                        if (n == null) return 0;\r\n                        if (!n[0]) return 0;\r\n                        return parseFloat(n[0]);\r\n                    }\r\n                    return strip(n1) - strip(n2);\r\n                });\r\n                files.map(readFile).reduce(function(chain, fp, idx) {\r\n                    return chain.then(function() {\r\n                        return fp;\r\n                    }).then(function(fileReader: FileReader|null) {\r\n                        if (fileReader) {\r\n                            var ext = (fileReader as any).name.slice(-3);\r\n                            if (ext == \"msq\") {\r\n                                s.addMSQ(fileReader.result as string);\r\n                            } else {\r\n                                s.addJSON(fileReader.result as string);\r\n                            }\r\n                        }\r\n                    }).catch(function(err) {\r\n                        alert(\"Loading MSQ failed: \" + err.message);\r\n                        console.error(err);\r\n                    });\r\n                }, Promise.resolve())\r\n                .then(this._reInitButtonsFromScore);\r\n            }\r\n\r\n            return false;\r\n        }\r\n\r\n        //#endregion\r\n\r\n        //#region keyboard event listeners\r\n\r\n        private _initKeyboardEventListeners() {\r\n            const s = this._sequencer;\r\n            document.addEventListener('keyup', function(e) {\r\n                s.appState.keyPresses = s.appState.keyPresses.filter(k => k !== e.key);\r\n                const isShifting = s.appState.keyPresses.indexOf('Shift') >= 0;\r\n                if (e.key == \"r\" && isShifting && s.canvasRecorder) {\r\n                    s.canvasRecorder.start();\r\n                }\r\n                if (e.key == \"s\" && isShifting && s.canvasRecorder) {\r\n                    s.canvasRecorder.stop();\r\n                    s.canvasRecorder.save(\"composer-song.webm\");\r\n                }\r\n            });\r\n            document.addEventListener('keydown',function(e) {\r\n                if (s.appState.keyPresses.indexOf(e.key) < 0) {\r\n                    s.appState.keyPresses.push(e.key);\r\n                }\r\n                const playBtn = document.getElementById('play') as HTMLButtonElement;\r\n                const stopBtn = document.getElementById('stop') as HTMLButtonElement;\r\n                const r = document.getElementById('scroll') as HTMLInputElement;\r\n                let val: number;\r\n                let redraw = false;\r\n                const isShifting = s.appState.keyPresses.indexOf('Shift') >= 0;\r\n                switch (e.key) {\r\n                case ' ': // space -> play/stop or restart with shift\r\n                    if (playBtn.disabled == false || isShifting) {\r\n                        if (s.appState.gameStatus === GameStatus.Edit) {\r\n                            playBtn.click();\r\n                        } else {\r\n                            if (isShifting) {\r\n                                s.appState.curPos = 0;\r\n                                r.valueAsNumber = 0;\r\n                                cancelAnimationFrame(s.appState.animeId);\r\n                                s.appState.animeId = window.requestAnimFrame(s.doMarioEnter);\r\n                            }\r\n                        }\r\n                    //   sequencer._onPlayListener.call(playBtn, sequencer);\r\n                    } else {\r\n                        stopBtn.click();\r\n                    //   sequencer._onStopListener.call(stopBtn, sequencer);\r\n                    }\r\n                    e.preventDefault();\r\n                    break; \r\n            \r\n                case 'ArrowLeft': // left -> scroll left\r\n                    r.valueAsNumber -= isShifting ? 1 : 0.2;\r\n                    redraw = true;\r\n                    e.preventDefault();\r\n                    break;\r\n            \r\n                case 'ArrowRight': // right -> scroll right\r\n                    r.valueAsNumber += isShifting ? 1 : 0.2;\r\n                    redraw = true;\r\n                    e.preventDefault();\r\n                    break;\r\n                }\r\n                if (redraw) {\r\n                    let event = new Event('input', {bubbles: true, cancelable: true});\r\n                    r.dispatchEvent(event);\r\n                }\r\n            });\r\n        }\r\n\r\n        //#endregion\r\n        \r\n        private _getOrCreateButton(x: number, y: number, w: number, h: number, id: string, images: HTMLImageElement[], clickHandler?: (this: SequencerButton, ev: SequencerBtnEvent) => any, className?: string) {\r\n            const s = this._sequencer;\r\n            let b = document.getElementById(id) as SequencerButton;\r\n            if (b === null) {\r\n                b = this._createButton({x,y,w,h,id,images,clickHandler,className});\r\n                s.container.appendChild(b as HTMLButtonElement);\r\n            } else {\r\n                b.images = images;\r\n            }\r\n            \r\n            return b;\r\n        }\r\n        \r\n        /**\r\n         * Translates App Container relative X + Y coordinates to positions on a grid\r\n         * Used for placement of notes, cursor placeholder and more\r\n         * @param realX X coordinate relative to top left of container\r\n         * @param realY Y coordinate relative to top left of container\r\n         * @returns false if outside the grid or hovering the G-Clef area, or [gridX, gridY]\r\n         */\r\n        public toGrid(realX: number, realY: number) {\r\n            const s = this._sequencer;\r\n            const { CHARSIZE, HALFCHARSIZE, MAGNIFY } = s.CONST;\r\n            const gridLeft   = (8   + 0) * MAGNIFY;\r\n            const gridTop    = (41     ) * MAGNIFY;\r\n            const gridRight  = (247 - 4) * MAGNIFY;\r\n            const gridBottom = (148 - 4) * MAGNIFY;\r\n            if (realX < gridLeft || realX > gridRight ||\r\n                realY < gridTop  || realY > gridBottom)\r\n                return false;\r\n\r\n            let gridX = Math.floor((realX - gridLeft) / CHARSIZE);\r\n            if (gridX % 2 != 0) return false; // Not near the bar\r\n            gridX /= 2;\r\n            const gridY = Math.floor((realY - gridTop) / HALFCHARSIZE);\r\n\r\n            // Consider G-Clef and repeat head area\r\n            if (s.appState.curPos == 0 && gridX < 2 || s.appState.curPos == 1 && gridX == 0)\r\n                return false;\r\n            else\r\n                return [gridX, gridY];\r\n        }\r\n    }\r\n}\r\n\r\nexport default UI;","import { SoundEntity } from \"./sound\";\r\nimport { App, InstrumentChordRecord, MarioSequencerSong, Mp3UpdateEvent } from \"app.types\";\r\nimport { MarioSequencer } from \"app\";\r\n\r\n/* \r\n    This file handles Audio Export for the sequencer. \r\n    Important information to consider:\r\n\r\n    Framerate of is assumed 60fps\r\n    TEMPO is in BPM (beats per min)\r\n\r\n    1 frame = 1/ 60\r\n    Beats per Second = TEMPO / 60\r\n    Seconds per each beat = 60 / TEMPO\r\n\r\n*/\r\n\r\n/**\r\n * Not currently used but can be used to get the duration of an AudioBufferSourceNode\r\n * @param sourceNode AudioBufferSourceNode (must have buffer set to return a duration)\r\n * @returns Duration in seconds\r\n */\r\nfunction getSourceNodeDuration(sourceNode: AudioBufferSourceNode): number {\r\n  const { buffer, playbackRate } = sourceNode;\r\n  if (!buffer) return 0;\r\n  return buffer.length / (buffer.sampleRate * playbackRate.value);\r\n}\r\n\r\n/**\r\n * Converts an array of notes encoded with instrument and scale information to a dictionary-style list of instruments and notes to be played\r\n * @param beatNotes A note array representing a single beat from the score\r\n * @returns A dictionary-like object where key is the instrument number, and value is an array of notes to be played at the same time\r\n */\r\nfunction beatToInstrumentChords(beatNotes: (string | number)[]) {\r\n  const beatChords: InstrumentChordRecord = {};\r\n  beatNotes.forEach((note, i) => {\r\n    if (typeof note === \"string\") return;\r\n    const instrumentNum = note >> 8;\r\n    const noteValue = note & 0xFF;\r\n    if (!beatChords[instrumentNum]) {\r\n      beatChords[instrumentNum] = [noteValue];\r\n    } else {\r\n      beatChords[instrumentNum].push(noteValue);\r\n    }\r\n  });\r\n  return beatChords;\r\n}\r\n\r\n/**\r\n * Generates a silent AudioBuffer at a specific length, used to \r\n * insert silence in to the generated audio when no notes are played on a given beat\r\n * @param context AudioContext to be used to generate silence\r\n * @param durationInSeconds Duration of silence\r\n * @returns Silent AudioBuffer for the duration specified\r\n */\r\nfunction createSilentBuffer(context: OfflineAudioContext, durationInSeconds: number): AudioBuffer {\r\n  const buffer = context.createBuffer(1, durationInSeconds * context.sampleRate, context.sampleRate);\r\n  for (let channel = 0; channel < buffer.numberOfChannels; channel++) {\r\n    const data = buffer.getChannelData(channel);\r\n    for (let i = 0; i < data.length; i++) {\r\n      data[i] = 0; // Set all samples to 0 (silence)\r\n    }\r\n  }\r\n  return buffer;\r\n}\r\n\r\n/**\r\n * Generates chords for instruments that are played on each beat, outputting them to an AudioBuffer using OfflineAudioContext \r\n * @param sounds Sounds loaded by the app\r\n * @param chords Object containing the notes played simultaneously by each instrument on each beat\r\n * @param lengthInSecs Duration that sound should play for (varies by song Tempo)\r\n * @returns AudioBuffer for an entire song beat\r\n */\r\nasync function getChordBuffer(app: MarioSequencer, chords: InstrumentChordRecord, nextChords: InstrumentChordRecord, lengthInSecs: number, beatCount: number, totalBeats: number) {\r\n\r\n  const { SOUNDS: sounds } = app.ASSETS;\r\n\r\n  // Before we generate any sounds for the current beat\r\n  // we need to know if the next beat is silent or not. \r\n  // Instrument samples can be longer than the time available, if\r\n  // they are allowed to play in to the next beat it can sound messy,\r\n  // but if we cut them off and nothing plays on the next beat\r\n  // that's jarring too. \r\n\r\n  /** \r\n   * Reducer function to transform an Instrument Chord dictionary\r\n   * in to an array of unique notes played on the current/next beat\r\n   */\r\n  const reduceNotes = (chordObj: InstrumentChordRecord) => {\r\n    return (prev: number[], cur: string, idx: number, arr: string[]) => {\r\n      const instrumentNotes = chordObj[parseInt(cur, 10)];\r\n      instrumentNotes.forEach((note) => {\r\n        if (prev.indexOf(note) < 0) prev.push(note);\r\n      });\r\n      return prev;\r\n    };\r\n  }\r\n  const notes = Object.keys(chords).reduce(reduceNotes(chords), [] as number[]);\r\n  const nextNotes = Object.keys(nextChords).reduce(reduceNotes(nextChords), [] as number[]);\r\n\r\n  // By default we will restrict the length of all sounds on this beat\r\n  // to the correct length for TEMPO\r\n  let restrictLength = true;\r\n\r\n  // If the next beat is a rest beat, we can let current samples\r\n  // play out fully\r\n  notes.forEach((note) => {\r\n    if (nextNotes.length === 0) {\r\n      restrictLength = false;\r\n    }\r\n  });\r\n\r\n  // Get a reference to all instrument sounds needed for this beat\r\n  const instrumentNums = Object.keys(chords).map((i) => parseInt(i, 10));\r\n  let longestSound: number = 0;\r\n  const buffers: Record<number, AudioBuffer> =\r\n    instrumentNums.reduce((prev, cur, idx, arr) => {\r\n      const instrumentBuffer = sounds[cur].buffer;\r\n      if (instrumentBuffer && instrumentBuffer.duration > longestSound) longestSound = instrumentBuffer.duration;\r\n      if (instrumentBuffer && !prev[cur]) prev[cur] = instrumentBuffer;\r\n      return prev;\r\n    }, {} as Record<number, AudioBuffer>);\r\n\r\n  // Setup AudioContext at set duration\r\n  const context = new OfflineAudioContext(2, 44100 * (restrictLength ? lengthInSecs : longestSound), 44100);\r\n  context.addEventListener(\"complete\", (ev) => {\r\n    const evt = new Event(\"mp3update\") as Mp3UpdateEvent;\r\n    evt.data = {\r\n      type: \"chordGenUpdate\",\r\n      value: beatCount / totalBeats\r\n    }\r\n    app.container.dispatchEvent(evt);\r\n  });\r\n  const destination = context.destination;\r\n  const semitoneRatio = Math.pow(2, 1 / 12);\r\n  const diff = [14, 12, 11, 9, 7, 6, 4, 2, 0, -1, -3, -5, -6];\r\n\r\n  // for each instrument\r\n  instrumentNums.forEach((instrumentNum) => {\r\n    const notes = chords[instrumentNum];\r\n\r\n    // for each note, add an audio source\r\n    // the instrument pitched to the right note \r\n    notes.forEach((note) => {\r\n      const source = context.createBufferSource();\r\n      const scale = note & 0x0F;\r\n      let semitone = diff[scale];\r\n      if ((note & 0x80) != 0) semitone++;\r\n      else if ((note & 0x40) != 0) semitone--;\r\n      source.buffer = buffers[instrumentNum];\r\n      source.playbackRate.value = Math.pow(semitoneRatio, semitone);\r\n      source.connect(destination);\r\n      source.start(0);\r\n\r\n      // If any instrument in the next beat plays this same note,\r\n      // we need to silence this note at the correct time\r\n      // if (nextNotes.indexOf(note) >= 0) {\r\n      //   source.stop(Math.ceil(lengthInSecs));\r\n      // }\r\n    });\r\n  });\r\n\r\n  // return this chord\r\n  return await context.startRendering();\r\n}\r\n\r\n/**\r\n * Exports a Mario Paint Sequencer song to MP3. Does not currently support dynamic Tempo changes that may be present in some MSQ files.\r\n * @param worker A reference to the web worker\r\n * @param sounds Instrument sounds currently loaded by the app\r\n * @param tempo The song Tempo\r\n * @param score The song itself. An array of beats, each containing an array of instrument notes.\r\n */\r\nexport async function songToAudio(app: MarioSequencer) {\r\n  const { curScore: song } = app.appState;\r\n  const { notes: score, end, tempo } = song;\r\n\r\n  // Setup timing (examples in comments)\r\n  const bps = Number(tempo) / 60; // 287bpm / 60 = 4.7833333333\r\n  const noBeats = end; // 96 beats\r\n  const seconds = noBeats / bps; // ~20 seconds\r\n  const singleBeatSeconds = seconds / noBeats; // ~.208 seconds for a single beat\r\n\r\n  // OfflineAudioContext to generate sound buffer without outputting to speakers\r\n  const context = new OfflineAudioContext(2, 44100 * seconds, 44100);\r\n  \r\n  // In order to fake a progress-like event for the OfflineAudioContext renderer\r\n  // we can tell it to suspend for every 2 seconds of audio rendering\r\n  // and use the onstatechange to post back rendering progress to the page\r\n  for (let i = 0; i < seconds; i += 2) {\r\n    context.suspend(i);\r\n  }\r\n  context.onstatechange = function (e: Event) {\r\n    if (context.state === \"suspended\") {\r\n      const evt = new Event(\"mp3update\") as Mp3UpdateEvent;\r\n      evt.data = {\r\n        type: \"songProgressUpdate\",\r\n        value: context.currentTime / seconds\r\n      };\r\n      app.container.dispatchEvent(evt);\r\n      context.resume();\r\n    }\r\n  }\r\n  // When this fires, rendering is complete but the page still has to \r\n  // generate a Blob URL and attach the Audio element to the page\r\n  context.oncomplete = function (e: Event) {\r\n    const evt = new Event(\"mp3update\") as Mp3UpdateEvent;\r\n      evt.data = {\r\n        type: \"songProgressUpdate\",\r\n        value: 1\r\n      };\r\n      app.container.dispatchEvent(evt);\r\n  }\r\n  const destination = context.destination;\r\n\r\n  const chords = score.map((beat) => beatToInstrumentChords(beat));\r\n\r\n  // For each beat, merge all chords / instrument sounds, or \r\n  // play silence if necessary\r\n  for (let i = 0; i < end; i++) {\r\n    const beat = score[i];\r\n\r\n    let beatBuffer: AudioBuffer;\r\n    if (beat.length === 0) {\r\n      // No notes, output silence\r\n      //beatBuffer = createSilentBuffer(context, singleBeatSeconds);\r\n      continue;\r\n    } else {\r\n      // Get merged AudioBuffer representing all sounds played on this beat\r\n      beatBuffer = await getChordBuffer(app, chords[i], chords[i + 1], singleBeatSeconds, i + 1, end);\r\n    }\r\n\r\n    // Create source node\r\n    const source = context.createBufferSource();\r\n    source.buffer = beatBuffer;\r\n    source.connect(destination);\r\n\r\n    // Set timing of this beat / sound and output\r\n    source.start(i * singleBeatSeconds);\r\n  }\r\n\r\n  // Output all beats to a single song AudioBuffer\r\n  const songBuffer = await context.startRendering();\r\n\r\n  // Generate MP3 as Blob URL\r\n  const blob = new Blob([await audioBufferToMp3(songBuffer)], { type: 'audio/mp3' });\r\n  const url = URL.createObjectURL(blob);\r\n\r\n  return url;\r\n}\r\n\r\n/**\r\n * LameJS' Mp3Encoder.encodeBuffer method expects each channel to be of type Int16Array. \r\n * AudioBuffer.getChannelData returns Float32Array. This method can be used to convert between the two.\r\n * @param buffer Float32Array returned by AudioBuffer.getChannelData\r\n * @returns Int16Array suitable for Mp3Encoder.encodeBuffer\r\n */\r\nfunction convertFloat32ToInt16(buffer: Float32Array): Int16Array {\r\n  const int16Buffer = new Int16Array(buffer.length);\r\n  for (let i = 0; i < buffer.length; i++) {\r\n    const floatVal = buffer[i];\r\n    const intVal = floatVal * 0x7fff; // convert float to signed 16-bit integer\r\n    int16Buffer[i] = intVal < 0 ? intVal + 0x10000 : intVal; // handle two's complement representation\r\n  }\r\n  return int16Buffer;\r\n}\r\n\r\n/**\r\n * Given an AudioBuffer object, returns an MP3 Blob object\r\n * @param audioBuffer Song in AudioBuffer format\r\n * @returns Mp3 Blob\r\n */\r\nfunction audioBufferToMp3(audioBuffer: AudioBuffer): Promise<Blob> {\r\n  return new Promise(async (resolve) => {\r\n    // Lazy load LameJS to save on bundle size\r\n    const ljs = await import(\"lamejs\");\r\n\r\n    const mp3Encoder = new ljs.Mp3Encoder(audioBuffer.numberOfChannels, audioBuffer.sampleRate, 128);\r\n    const samples = convertFloat32ToInt16(audioBuffer.getChannelData(0)).length;\r\n    const sampleBlockSize = 1152; // This value is fixed in the MP3 format\r\n    const mp3Data: Int8Array[] = [];\r\n\r\n    // Iterate through all samples, pushing an encoded stereo buffer to the mp3Data array \r\n    for (let i = 0; i < samples; i += sampleBlockSize) {\r\n      const left = convertFloat32ToInt16(audioBuffer.getChannelData(0)).subarray(i, i + sampleBlockSize);\r\n      const right = audioBuffer.numberOfChannels === 2 ? convertFloat32ToInt16(audioBuffer.getChannelData(1)).subarray(i, i + sampleBlockSize) : left;\r\n      const mp3Block = mp3Encoder.encodeBuffer(left, right);\r\n      if (mp3Block.length > 0) {\r\n        mp3Data.push(mp3Block);\r\n      }\r\n    }\r\n\r\n    // Convert to Blob\r\n    const mp3Blob = new Blob(mp3Data, { type: 'audio/mp3' });\r\n    resolve(mp3Blob);\r\n  });\r\n}","// CanvasRecorder.js - smusamashah\r\n// To record canvas effitiently using MediaRecorder\r\n// https://webrtc.github.io/samples/src/content/capture/canvas-record/\r\n\r\nimport { MarioSequencer } from \"app\";\r\n\r\nexport class CanvasRecorder {\r\n    private _app: MarioSequencer;\r\n    private _vbps?: number;\r\n    private stream: MediaStream;\r\n    private recordedBlobs: Blob[] = [];\r\n    private supportedType?: string;\r\n    private mediaRecorder: MediaRecorder | null = null;\r\n    private video: HTMLVideoElement;\r\n    constructor(app: MarioSequencer, canvas: HTMLCanvasElement, video_bits_per_sec?: number) {\r\n        this.handleDataAvailable = this.handleDataAvailable.bind(this);\r\n        this.handleStop = this.handleStop.bind(this);\r\n\r\n        this._app = app;\r\n        this._vbps = video_bits_per_sec;\r\n        this.video = document.createElement('video');\r\n        this.video.style.display = 'none';\r\n        \r\n        this.stream = canvas.captureStream();\r\n        if (typeof this.stream == undefined || !this.stream) {\r\n            return;\r\n        }\r\n    }\r\n    public start() {\r\n        if (!this._app.MSDestination) this._app.MSDestination = this._app.AC.createMediaStreamDestination();\r\n\r\n        let types = [\r\n            \"video/webm\",\r\n            'video/webm,codecs=vp9',\r\n            'video/vp8',\r\n            \"video/webm\\;codecs=vp8\",\r\n            \"video/webm\\;codecs=daala\",\r\n            \"video/webm\\;codecs=h264\",\r\n            \"video/mpeg\"\r\n        ];\r\n\r\n        for (let i in types) {\r\n            if (MediaRecorder.isTypeSupported(types[i])) {\r\n                this.supportedType = types[i];\r\n                break;\r\n            }\r\n        }\r\n        if (this.supportedType == null) {\r\n            console.log(\"No supported type found for MediaRecorder\");\r\n        }\r\n        let options = { \r\n            mimeType: this.supportedType,\r\n            videoBitsPerSecond: this._vbps || 2500000, // 2.5Mbps,\r\n            audioBitsPerSecond: this._vbps || 2500000\r\n        };\r\n\r\n        this.recordedBlobs = [];\r\n        try {\r\n            const mediaStream = new MediaStream();\r\n            mediaStream.addTrack(this.stream.getVideoTracks()[0]);\r\n            mediaStream.addTrack(this._app.MSDestination.stream.getAudioTracks()[0]);\r\n            this.mediaRecorder = new MediaRecorder(mediaStream, options);\r\n        } catch (e) {\r\n            alert('MediaRecorder is not supported by this browser.');\r\n            console.error('Exception while creating MediaRecorder:', e);\r\n            return;\r\n        }\r\n\r\n        console.log('Created MediaRecorder', this.mediaRecorder, 'with options', options);\r\n        this.mediaRecorder.onstop = this.handleStop;\r\n        this.mediaRecorder.ondataavailable = this.handleDataAvailable;\r\n        this.mediaRecorder.start(100); // collect 100ms of data blobs\r\n        console.log('MediaRecorder started', this.mediaRecorder);\r\n    }\r\n    public stop() {\r\n        this.mediaRecorder?.stop();\r\n        console.log('Recorded Blobs: ', this.recordedBlobs);\r\n        this.video.controls = true;\r\n    }\r\n    public save(filename: string) {\r\n        const name = filename || 'recording.webm';\r\n        const blob = new Blob(this.recordedBlobs, { type: this.supportedType });\r\n        const url = window.URL.createObjectURL(blob);\r\n        const a = document.createElement('a');\r\n        a.style.display = 'none';\r\n        a.href = url;\r\n        a.download = name;\r\n        document.body.appendChild(a);\r\n        a.click();\r\n        setTimeout(() => {\r\n            document.body.removeChild(a);\r\n            window.URL.revokeObjectURL(url);\r\n        }, 100);\r\n    }\r\n    private handleDataAvailable(event: BlobEvent) {\r\n        if (event.data && event.data.size > 0) {\r\n            this.recordedBlobs.push(event.data);\r\n        }\r\n    }\r\n    private handleStop(event: Event) {\r\n        console.log('Recorder stopped: ', event);\r\n        const superBuffer = new Blob(this.recordedBlobs, { type: this.supportedType });\r\n        this.video.src = window.URL.createObjectURL(superBuffer);\r\n    }\r\n    \r\n}\r\n","import {\r\n    App,\r\n    BeatButton,\r\n    GameStatus,\r\n    IMarioSequencerAssets,\r\n    IMarioSequencerProps,\r\n    InstrumentButton,\r\n    ISequencerBtnCreationArgs,\r\n    MarioSequencerAppState,\r\n    MarioSequencerSong,\r\n    Mp3UpdateEvent,\r\n    SequencerBtnEvent,\r\n    SequencerButton,\r\n    SequencerSlider,\r\n    ToggleButton\r\n} from \"./app.types\";\r\nimport { SoundEntity, SoundManager } from \"./sound\";\r\nimport EasyTimer from \"./timer\";\r\nimport EmbeddedSongs from \"./songs\";\r\nimport { Mario } from \"./mario\";\r\nimport UI from \"./ui\";\r\nimport Utils from \"./utils\";\r\n\r\nimport styles from \"./app.module.scss\";\r\nimport { AddEvents, EmitClickEvent } from \"./eventHandling\";\r\nimport { songToAudio } from \"./mp3export\";\r\nimport { CanvasRecorder } from \"./recorder\";\r\n\r\n// Ensure all assets are bundled as necessary\r\nfunction requireAll(r: any) { r.keys().forEach(r); }\r\nrequireAll(require.context('../public/wav', true, /\\.wav$/));\r\nrequireAll(require.context('../public/image', true, /\\.png$/));\r\n\r\n// Service worker for cached offline loading\r\nif ('serviceWorker' in navigator) {\r\n    window.addEventListener('load', () => {\r\n        navigator.serviceWorker.register('/service-worker.js').then(registration => {\r\n            console.log('SW registered: ', registration);\r\n        }).catch(registrationError => {\r\n            console.log('SW registration failed: ', registrationError);\r\n        });\r\n    });\r\n}\r\n\r\n// Shim for RAF\r\nwindow.requestAnimFrame = (function () {\r\n    return window.requestAnimationFrame ||\r\n        (window as any).webkitRequestAnimationFrame ||\r\n        (window as any).mozRequestAnimationFrame ||\r\n        (window as any).oRequestAnimationFrame ||\r\n        (window as any).msRequestAnimationFrame ||\r\n        function (callback) {\r\n            window.setTimeout(callback, 1000 / 60);\r\n        };\r\n})();;\r\n\r\nexport class MarioSequencer {\r\n\r\n    /** UI Loader - UI setup kept separate from rest of app logic */\r\n    private ui: UI.Loader;\r\n\r\n    private soundManager: SoundManager;\r\n\r\n    /** Moustachioed plumber and hero of the Mushroom Kingdom */\r\n    public mario?: Mario;\r\n\r\n    /** Web AudioContext, used for audio playback */\r\n    public AC: AudioContext = (window.AudioContext) ? new AudioContext() : new window.webkitAudioContext();\r\n\r\n    public MSDestination: MediaStreamAudioDestinationNode | null = null;\r\n\r\n    /** Layer 1 Canvas - for rendering of Mario Paint composer background / UI elements */\r\n    public Layer1?: HTMLCanvasElement;\r\n\r\n    /** Layer 2 Canvas - for rendering of Mario Paint composer score and mario etc */\r\n    public Layer2?: HTMLCanvasElement;\r\n\r\n    /** Layer 1 Rendering Context (2D) */\r\n    public L1C: CanvasRenderingContext2D | null = null;\r\n\r\n    /** Layer 2 Rendering Context (2D) */\r\n    public L2C: CanvasRenderingContext2D | null = null;\r\n\r\n    /** HTML Container for the app */\r\n    public container: HTMLElement;\r\n\r\n    /** App state */\r\n    public appState: MarioSequencerAppState = {\r\n        mouseX: 0,\r\n        mouseY: 0,\r\n        keyPresses: [],\r\n        animeId: 0,\r\n        resizing: false,\r\n        currentTool: 0,\r\n        curPos: 0,\r\n        curScore: {\r\n            beats: 4,\r\n            end: 0,\r\n            loop: false,\r\n            notes: [],\r\n            tempo: \"0\"\r\n        },\r\n        history: [],\r\n        gameStatus: GameStatus.Edit\r\n    }\r\n\r\n    /** Stores any parameters/options passed to the app using the URL Query String */\r\n    private _urlOptions: Record<string, any> = {};\r\n\r\n    /** Maximum number of bars in score */\r\n    public curMaxBars: number;\r\n\r\n    private _maxHistory: number = 10;\r\n\r\n    /** App constants - updated on window resize */\r\n    public CONST: IMarioSequencerProps;\r\n\r\n    /** Image assets, sound assets and button references */\r\n    public ASSETS: IMarioSequencerAssets = {\r\n        BUTTONS: [],\r\n        SOUNDS: [],\r\n    };\r\n\r\n    /** Timers used by the app to facilitate certain sprite animations */\r\n    public TIMERS: Record<string, EasyTimer> = {};\r\n\r\n    /** External Utils */\r\n    private getConstants: (this: MarioSequencer, opts: any, container: HTMLElement) => IMarioSequencerProps;\r\n\r\n    /** Canvas recorder for video recording */\r\n    public canvasRecorder: CanvasRecorder | null = null;\r\n\r\n    /**\r\n     * A new Mario Paint Sequencer\r\n     * @param containerSelector The container in which to draw the game\r\n     */\r\n    constructor(containerSelector: string) {\r\n\r\n        // Class fn bindings\r\n        this.getConstants = Utils.getConstants.bind(this);\r\n\r\n        this.doAnimation = this.doAnimation.bind(this);\r\n        this.doMarioEnter = this.doMarioEnter.bind(this);\r\n        this.doMarioLeave = this.doMarioLeave.bind(this);\r\n        this.doMarioPlay = this.doMarioPlay.bind(this);\r\n        this._downloadJSON = this._downloadJSON.bind(this);\r\n        this._downloadMP3 = this._downloadMP3.bind(this);\r\n\r\n        const sequencer = this;\r\n        this.ui = new UI.Loader(this);\r\n        this.soundManager = new SoundManager(this);\r\n\r\n        const containerEl = document.querySelector(containerSelector) as App;\r\n        if (containerEl) {\r\n            const initialMagnify = Utils.getScaledMagnify();\r\n            containerEl.addEventListener(\"mp3update\", this._onMp3Update);\r\n            containerEl.classList.add(styles.marioSequencer);\r\n            containerEl.style.setProperty('--scaledMagnify', initialMagnify.toString());\r\n\r\n            // Get manual options from URL / Search String\r\n            window.location.search.substr(1).split('&').forEach((s) => {\r\n                const tmp = s.split('=');\r\n                this._urlOptions[tmp[0]] = tmp[1];\r\n            });\r\n\r\n            // Set constants based on set options\r\n            this.CONST = this.getConstants(this._urlOptions, containerEl);\r\n            this.curMaxBars = this.CONST.DEFAULTMAXBARS;\r\n            this.container = containerEl;\r\n\r\n            // Resize UI option event listener\r\n            const b = document.getElementById(\"magnify\") as HTMLSelectElement;\r\n            b.addEventListener(\"change\", (e) => {\r\n                let mag = (e.target as HTMLSelectElement).selectedIndex + 1;\r\n                this._resizeScreen(mag);\r\n            });\r\n\r\n            // Respond to resize events if magnifaction is set to \"Scale\"\r\n            window.addEventListener(\"resize\", () => {\r\n                const select = document.getElementById('magnify') as HTMLSelectElement;\r\n                if (select) {\r\n                    const magIdx = select.selectedIndex + 1;\r\n                    this._resizeScreen(magIdx);\r\n                }\r\n            });\r\n\r\n            // Score download\r\n            const downloadJSONBtn = document.querySelector('button#dlJSON');\r\n            if (downloadJSONBtn) {\r\n                downloadJSONBtn.addEventListener(\"click\", this._downloadJSON);\r\n            }\r\n            const downloadMP3Btn = document.querySelector('button#dlMP3');\r\n            if (downloadMP3Btn) {\r\n                downloadMP3Btn.addEventListener(\"click\", this._downloadMP3);\r\n            }\r\n            const backBtn = document.querySelector('button#dismissDL');\r\n            if (backBtn) {\r\n                backBtn.addEventListener(\"click\", () => {\r\n                    document.querySelector('audio#export')?.remove();\r\n                    document.querySelector('.downloadOpts')?.classList.remove('rendering', 'dlReady');\r\n                });\r\n            }\r\n\r\n            // Sharing\r\n            document.getElementById('shareLink')?.addEventListener('click', (e) => {\r\n                const url = document.getElementById('shareUrl') as HTMLInputElement;\r\n                (document.getElementById('inclSong') as HTMLInputElement).checked = false;\r\n                url.value = window.location.href;\r\n            });\r\n            document.getElementById('inclSong')?.addEventListener('click', function(e) {\r\n                const url = document.getElementById('shareUrl') as HTMLInputElement; \r\n                let port = window.location.port;\r\n                let urlVal = `${window.location.protocol}//${window.location.hostname}${port !== \"80\" ? \":\" + port : \"\"}${window.location.pathname}`;\r\n                if ((this as HTMLInputElement).checked) {\r\n                    const bars = sequencer.appState.curScore.notes;\r\n                    let s = \"\";\r\n                    bars.forEach((bar) => {\r\n                        // MSQ parsing code expects 3 notes max per bar\r\n                        for (let i = 0; i <= Math.min(bar.length,2); i++) {\r\n                            const note = bar[i] as number;\r\n                            if (!note) {\r\n                                s += [...Array(2-i+1)].reduce((prev,cur) => prev + \"0\", \"\");\r\n                            } else {\r\n                                const scale = (note & 0xff) + 1;\r\n                                const tone = ((note >> 8) & 0xff) + 1;\r\n                                s += scale.toString(16);\r\n                                if (scale > 0) s += tone.toString(16);\r\n                            }\r\n                        }\r\n                        s += '\\r';\r\n                    });\r\n                    urlVal += `?S=${s}&T=${sequencer.appState.curScore.tempo}&L=${sequencer.appState.curScore.loop ? 'T' : 'F'}&E=${sequencer.appState.curScore.end}&B=${sequencer.appState.curScore.beats === 4 ? \"T\" : \"F\"}`;\r\n                } \r\n                url.value = urlVal;\r\n            });\r\n            document.getElementById('shareCopy')?.addEventListener('click', (e) => {\r\n                const url = document.getElementById('shareUrl') as HTMLInputElement; \r\n                url.select(); \r\n                url.setSelectionRange(0,99999); \r\n                navigator.clipboard.writeText(url.value);\r\n            });\r\n\r\n            // Setup UI\r\n            this.soundManager.loadSounds().then(() => {\r\n                this.ui.init().then(() => {\r\n\r\n                    if (this.Layer2) this.canvasRecorder = new CanvasRecorder(this, this.Layer2);\r\n\r\n                    AddEvents(this);\r\n\r\n                    // Remove loading 'spinner'\r\n                    const spinner = document.getElementById(\"spinner\");\r\n                    if (spinner) {\r\n                        this.container.removeChild(spinner);\r\n                    }\r\n\r\n                    // Action any URL params\r\n                    this._actionUrlParams();\r\n\r\n                });\r\n            });\r\n        } else {\r\n            throw new Error(`Unable to find selector: ${containerSelector}`);\r\n        }\r\n    }\r\n\r\n    private _actionUrlParams() {\r\n        const OPTS = this._urlOptions;\r\n        const sequencer = this;\r\n        try {\r\n            if (Object.keys(OPTS).length == 0) return;\r\n\r\n            if (OPTS['url'] != undefined) {\r\n\r\n                this.resetScore();\r\n                const url = OPTS['url'];\r\n\r\n                // Load url\r\n                new Promise(function (resolve, reject) {\r\n                    const req = new XMLHttpRequest();\r\n                    req.open('GET', url);\r\n                    req.onload = function () {\r\n                        if (req.status == 200) {\r\n                            resolve(req.response);\r\n                        } else {\r\n                            reject(Error(req.statusText));\r\n                        }\r\n                    };\r\n\r\n                    req.onerror = function () {\r\n                        reject(Error(\"Network Error\"));\r\n                    };\r\n\r\n                    req.send();\r\n                }).then(function (response) {\r\n\r\n                    // Parse response as MSQ or Sequencer JSON\r\n                    let msq = false;\r\n                    if (url.slice(-3) == \"msq\") {\r\n                        sequencer.addMSQ(response as string);\r\n                    } else {\r\n                        sequencer.addJSON(response as string);\r\n                    }\r\n\r\n                    sequencer._reInitButtonsFromScore();\r\n\r\n                    sequencer._autoPlayIfDemanded(OPTS);\r\n\r\n                }).catch(function (err) {\r\n                    alert(\"Downloading File: \" + url + \" failed :\" + err);\r\n                    console.error(\"Downloading File: \" + url + \" failed :\" + err.stack);\r\n                });\r\n\r\n            } else if (OPTS.S != undefined || OPTS.SCORE != undefined) {\r\n\r\n                // Song passed in as Query String param\r\n                const score = OPTS.SCORE || OPTS.S;\r\n                const tempo = OPTS.TEMPO || OPTS.T;\r\n                let loop = (OPTS.LOOP || OPTS.L);\r\n                const end = OPTS.END || OPTS.E;\r\n                let beats = (OPTS.TIME44 || OPTS.B);\r\n\r\n                if (tempo == undefined || loop == undefined || end == undefined ||\r\n                    beats == undefined) {\r\n                    throw new Error(\"Not enough parameters\");\r\n                }\r\n\r\n                loop = loop.toUpperCase();\r\n                beats = beats.toUpperCase();\r\n\r\n                const text = \"SCORE=\" + score + \"\\n\" +\r\n                    \"TEMPO=\" + tempo + \"\\n\" +\r\n                    \"LOOP=\" + ((loop == \"T\" || loop == \"TRUE\") ? \"TRUE\" : \"FALSE\") + \"\\n\" +\r\n                    \"END=\" + end + \"\\n\" +\r\n                    \"TIME44=\" + ((beats == \"T\" || beats == \"TRUE\") ? \"TRUE\" : \"FALSE\");\r\n\r\n                sequencer.resetScore();\r\n                sequencer.addMSQ(text);\r\n                sequencer._reInitButtonsFromScore();\r\n\r\n                sequencer._autoPlayIfDemanded(OPTS);\r\n            }\r\n        } catch (err: unknown) {\r\n\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Resets music score\r\n     */\r\n    public resetScore() {\r\n        this.appState.curScore.notes = [];\r\n        this.curMaxBars = 0;\r\n        this.appState.curScore.beats = 4;\r\n        // Loop button itself has a state, so keep current value;\r\n        // CurScore.loop = false;\r\n        this.appState.curScore.end = 0;\r\n        this.appState.curScore.tempo = 0;\r\n    }\r\n\r\n    /**\r\n     * Initialises the music / score\r\n     */\r\n    public initMusicScore() {\r\n        const { DEFAULTMAXBARS, DEFAULTTEMPO } = this.CONST;\r\n        const tmpa = [];\r\n        for (let i = 0; i < DEFAULTMAXBARS; i++) tmpa[i] = [];\r\n        this.appState.curScore.notes = tmpa;\r\n        this.curMaxBars = DEFAULTMAXBARS;\r\n        const s = document.getElementById(\"scroll\") as SequencerSlider;\r\n        s.max = (DEFAULTMAXBARS - 6).toString();\r\n        s.value = \"0\";\r\n        this.appState.curScore.loop = false;\r\n        (document.getElementById(\"loop\") as ToggleButton)?.reset();\r\n        this.appState.curScore.end = DEFAULTMAXBARS - 1;\r\n        this.appState.curScore.tempo = DEFAULTTEMPO;\r\n        const tempoInput = document.getElementById(\"tempo\") as SequencerSlider;\r\n        if (tempoInput) tempoInput.value = DEFAULTTEMPO.toString();\r\n        this.appState.curScore.beats = 4;\r\n        const e = new Event(\"click\");\r\n        (e as any).soundOff = true;\r\n        const beatBtn = document.getElementById(\"4beats\") as ToggleButton;\r\n        if (beatBtn) beatBtn.dispatchEvent(e);\r\n    }\r\n\r\n    private _reInitButtonsFromScore() {\r\n        const b = document.getElementById(this.appState.curScore.beats == 3 ? '3beats' : '4beats') as HTMLButtonElement;\r\n        const e = new Event(\"click\");\r\n        (e as any).soundOff = true;\r\n        b.dispatchEvent(e);\r\n\r\n        const r = document.getElementById('scroll') as HTMLInputElement;\r\n        this.curMaxBars = this.appState.curScore.end + 1;\r\n        r.max = (this.curMaxBars - 6).toString();\r\n        r.value = \"0\";\r\n        this.appState.curPos = 0;\r\n\r\n        const tempoRange = document.getElementById(\"tempo\") as HTMLInputElement;\r\n        let tempo = this.appState.curScore.notes[0][0];\r\n        if (typeof tempo == \"string\" && tempo.substr(0, 5) == \"TEMPO\") {\r\n            tempo = tempo.split(\"=\")[1];\r\n            this.appState.curScore.tempo = tempo;\r\n            tempoRange.value = tempo;\r\n        }\r\n    }\r\n\r\n    public addMSQ(text: string) {\r\n        const lines = text.split(/\\r\\n|\\r|\\n/);\r\n        const keyword = [\"SCORE\", \"TEMPO\", \"LOOP\", \"END\", \"TIME44\"];\r\n        const values: any = {};\r\n        lines.forEach(function (line, i) {\r\n            if (line === \"\") return;\r\n            const kv = line.split(\"=\");\r\n            const k = kv[0];\r\n            const v = kv[1];\r\n            if (i < keyword.length && k !== keyword[i]) {\r\n                throw new Error(\"Line \" + i + \" must start with '\" + keyword[i] + \"'\");\r\n            }\r\n            values[k] = v;\r\n        });\r\n\r\n        const oldEnd = this.appState.curScore.end;\r\n        const s = values.SCORE;\r\n        let i = 0, count = this.appState.curScore.end;\r\n        // MSQ format is variable length string.\r\n        out:\r\n        while (i < s.length) {\r\n            const bar = [];\r\n            for (let j = 0; j < 3; j++) {\r\n                if (s[i] === \"\\r\" || s[i] == undefined) break out;\r\n                let scale = parseInt(s[i++], 16);\r\n                if (scale !== 0) {\r\n                    scale -= 1;\r\n                    const tone = parseInt(s[i++], 16) - 1;\r\n                    const note = (tone << 8) | scale;\r\n                    bar.push(note);\r\n                }\r\n            }\r\n            this.appState.curScore.notes[count++] = bar;\r\n        }\r\n\r\n        this.appState.curScore.end += parseInt(values.END) - 1;\r\n        if (this.appState.curScore.tempo != values.TEMPO)\r\n            this.appState.curScore.notes[oldEnd].splice(0, 0, \"TEMPO=\" + values.TEMPO);\r\n        this.appState.curScore.tempo = values.TEMPO;\r\n        const beats = (values.TIME44 == \"TRUE\") ? 4 : 3;\r\n        this.appState.curScore.beats = beats;\r\n        // click listener will set CurScore.loop\r\n        const b = document.getElementById(\"loop\") as ToggleButton;\r\n        (values.LOOP == \"TRUE\") ? b.set() : b.reset();\r\n    }\r\n\r\n    public addJSON(text: string) {\r\n        const json = JSON.parse(text);\r\n        for (let i = 0; i < json.end; i++)\r\n            this.appState.curScore.notes.push(json.notes[i]);\r\n\r\n        const notes = this.appState.curScore.notes[this.appState.curScore.end];\r\n        if (this.appState.curScore.tempo != json.tempo && notes.length != 0) {\r\n            const tempostr = notes[0];\r\n            if (typeof tempostr != \"string\") {\r\n                notes.splice(0, 0, \"TEMPO=\" + json.tempo);\r\n            }\r\n        }\r\n        this.appState.curScore.tempo = json.tempo;\r\n\r\n        this.appState.curScore.end += json.end;\r\n\r\n        const b = document.getElementById(\"loop\") as ToggleButton;\r\n        if (this.appState.curScore.loop) b.set; else b.reset();\r\n    }\r\n\r\n    public updateHistory() {\r\n        this.appState.history.push({ ...this.appState });\r\n        if (this.appState.history.length > this._maxHistory) {\r\n            this.appState.history = this.appState.history.slice(0 - this._maxHistory);\r\n        }\r\n    }\r\n\r\n    //#endregion\r\n\r\n    //#region draw functions\r\n\r\n    /**\r\n     * Draw the musical score for a given position\r\n     * @param pos The musical bar index / position in the score, usually incremented by Mario.play()\r\n     * @param notes The notes of the song\r\n     * @param scroll Used for Mario's position, helping to determine when Mario should jump and notes should bounce etc\r\n     */\r\n    public drawScore(pos: number, notes: (string | number)[][], scroll: number) {\r\n        const { CHARSIZE, HALFCHARSIZE, MAGNIFY, OFFSETLEFT, OFFSETTOP, SCRHEIGHT } = this.CONST;\r\n        const { IMAGES, SOUNDS } = this.ASSETS;\r\n        const SCREEN = this.Layer2;\r\n        if (this.mario && IMAGES && SCREEN && this.L1C && this.L2C) {\r\n\r\n            // Clip note area on X-axis, within score area (8,41 to 247,148)\r\n            this.L2C.clearRect(0, 0, SCREEN.width, SCREEN.height);\r\n            this.L2C.save();\r\n            this.L2C.rect(8 * MAGNIFY, 0, (247 - 8 + 1) * MAGNIFY, SCRHEIGHT * MAGNIFY);\r\n            this.L2C.clip();\r\n\r\n            // Get Grid Co-ordinates of mouse\r\n            const realX: number = this.appState.mouseX - OFFSETLEFT;\r\n            const realY: number = this.appState.mouseY - OFFSETTOP;\r\n            const g: boolean | number[] = this.ui.toGrid(realX, realY);\r\n            let gridX: number | undefined;\r\n            let gridY: number | undefined;\r\n\r\n            // Coordinates only needed in Edit mode\r\n            if (this.appState.gameStatus == GameStatus.Edit && g !== false) {\r\n                gridX = g[0];\r\n                gridY = g[1];\r\n                // If mouse cursor on or under the C, draw horizontal line\r\n                if (gridY >= 11) this._drawHorizontalBar(gridX, 0);\r\n            }\r\n\r\n            // If G-Clef should be drawn, draw it\r\n            if (this.ASSETS.IMAGES && pos == 0) {\r\n                const w = this.ASSETS.IMAGES.GClef.width;\r\n                const h = this.ASSETS.IMAGES.GClef.height;\r\n\r\n                this.L2C.drawImage(\r\n                    this.ASSETS.IMAGES.GClef,\r\n                    0, 0, w, h,\r\n                    (9 - scroll) * MAGNIFY,\r\n                    48 * MAGNIFY,\r\n                    w * MAGNIFY,\r\n                    h * MAGNIFY\r\n                );\r\n\r\n                // If song loops, draw repeat head\r\n                if (this.appState.curScore.loop) {\r\n                    this._drawRepeatHead(41 - scroll);\r\n                }\r\n                // If at position 1 and song loops, draw repeat head\r\n            } else if (pos == 1 && this.appState.curScore.loop) {\r\n                this._drawRepeatHead(9 - scroll);\r\n            }\r\n\r\n            const beats = this.appState.curScore.beats;\r\n\r\n            /** A vertical orange bar is drawn to demarcate each bar / measure in the score.\r\n             * Because we are scrolling and clipping the timeline as we edit or play the song, \r\n             * the positional indexes (relative to the left of the screen) at which we should \r\n             * draw these orange lines also changes.\r\n             * \r\n             * Because the G-Clef and Repeat Head take up the first two grid positions -  \r\n             * when pos is zero, we must draw each orange line (representing the start of a \r\n             * measure) at pos + 2, every N beats. N is 4 in 4/4, or 3 in 3/4.\r\n             * \r\n             * An orange line will be drawn on:\r\n             * \r\n             *    barBeingDrawn % beats == (beats - 1) - (pos+1 % beats)\r\n             * \r\n             * For an explanation of why this works, consider the scenario where the current\r\n             * position is 0, the current song is in 4/4, and the bar being drawn is 2nd from\r\n             * the left of the screen. \r\n             * \r\n             * 2 % 4 == (4-1) - (0 + 1 % 4) ... OR: \r\n             * \r\n             * 2 == 3 - 1  (which is true... so an orange bar will be drawn)\r\n             * \r\n             * The result of:\r\n             * \r\n             *    (beats - 1) - (position + 1 % beats)\r\n             * \r\n             * is:\r\n             * \r\n             *    2, 1, 0, 3, 2, 1, 0, 3, ..... (if beats = 4)\r\n             * \r\n             *    2, 1, 0, 2, 1, 0, 2, 1, ..... (if beats = 3)\r\n             */\r\n            const orange = (beats == 4) ? 3 - ((pos + 1) % 4) : 2 - ((pos + 3) % 3);\r\n\r\n\r\n            /* DRAW VERTICAL BARS:\r\n             * Iterate through the vertical drawing positions on the grid\r\n             * That run along the X-axis\r\n             */\r\n\r\n            /* If pos < 2, start with the 1st or 2nd bars as the G-Clef and \r\n             * Repeat Head take up the first two grid positions\r\n             */\r\n            let i = (pos < 2) ? (2 - pos) : 0;\r\n\r\n            // There are 9 drawable positions on the X-axis, using the game's grid system\r\n            for (; i < 9; i++) {\r\n                const xorg = 16 + 32 * i - scroll;\r\n                const x = xorg * MAGNIFY;\r\n\r\n                /** The bar in the entire score the current loop iteration i represents */\r\n                const barnum = pos + i - 2;\r\n\r\n                // If we are drawing the final bar, draw the Repeat symbol or End Mark\r\n                if (barnum == this.appState.curScore.end) {\r\n                    const img = this.appState.curScore.loop ? IMAGES.Repeat[1] : IMAGES.EndMark;\r\n                    this.L2C.drawImage(img, x - 7 * MAGNIFY, 56 * MAGNIFY);\r\n                }\r\n\r\n                // Draw vertical line on each beat\r\n                this.L2C.beginPath();\r\n                this.L2C.setLineDash([MAGNIFY, MAGNIFY]);\r\n                this.L2C.lineWidth = MAGNIFY;\r\n                if (i % beats == orange) {\r\n                    if (this.appState.gameStatus == GameStatus.Edit) this._drawBarNumber(i, barnum / beats + 1);\r\n                    this.L2C.strokeStyle = '#F89000'; // Orange\r\n                } else {\r\n                    this.L2C.strokeStyle = '#A0C0B0';\r\n                }\r\n                this.L2C.moveTo(x, 41 * MAGNIFY);\r\n                this.L2C.lineTo(x, 148 * MAGNIFY);\r\n                this.L2C.stroke();\r\n\r\n                /** Notes for the current beat */\r\n                const b = notes[barnum];\r\n\r\n                // If no notes to draw, skip \r\n                if (b == undefined) continue;\r\n\r\n                /* DRAW THE NOTES\r\n                 * Notes bounce as Mario jumps on them (visual feedback for the notes sounding out), \r\n                 * and because Mario is not always in the center of the screen - \r\n                 * he enters stage left, leaves stage right - we may need to position them accordingly\r\n                 */\r\n\r\n                /**\r\n                 * The amount by which the drawn character should drawn bouncing downward\r\n                 */\r\n                let bounceDelta = 0;\r\n\r\n                // If music is playing and Mario has already hit the beat being drawn...\r\n                if (this.appState.gameStatus == GameStatus.Playing && this.mario.pos - 2 == barnum) {\r\n                    /** Distance from Mario is used to determine the bounce */\r\n                    let idx;\r\n                    // If Mario is center screen\r\n                    if (this.mario.x == 120) {\r\n                        idx = (this.mario.scroll >= 16) ? this.mario.scroll - 16 : this.mario.scroll + 16;\r\n                    } else {\r\n                        idx = this.mario.x + 8 - xorg;\r\n                    }\r\n                    const tbl = [0, 1, 2, 3, 3, 4, 5, 5, 6, 6, 7, 7, 8, 8, 8, 8,\r\n                        8, 8, 8, 8, 8, 7, 7, 6, 6, 5, 5, 4, 3, 3, 2, 1, 0];\r\n                    bounceDelta = tbl[Math.round(idx)];\r\n                }\r\n\r\n                /** Set to true when the current note is below middle C. Ensures a horizontal line is drawn behind the note. */\r\n                let hflag = false;\r\n\r\n                // For each note in the current beat\r\n                for (let j = 0; j < b.length; j++) {\r\n                    const bNote = b[j];\r\n                    if (typeof bNote === \"string\") continue; // for dynamic TEMPO\r\n\r\n                    const sndnum = bNote >> 8;\r\n                    const scale = bNote & 0x0F;\r\n\r\n                    // When CurChar is eraser, and the mouse cursor is on the note,\r\n                    // an Image of note blinks.\r\n                    if (this.appState.currentTool == 16 && g != false && i == gridX && scale == gridY &&\r\n                        this.TIMERS.eraser.currentFrame == 1) { continue; }\r\n\r\n                    if (!hflag && (scale >= 11)) {\r\n                        hflag = true;\r\n                        this._drawHorizontalBar(i, scroll);\r\n                    }\r\n\r\n                    // Draw instrument icon\r\n                    const soundImage = SOUNDS[sndnum].image;\r\n                    if (soundImage) {\r\n                        this.L2C.drawImage(soundImage, x - HALFCHARSIZE,\r\n                            (40 + scale * 8 + bounceDelta) * MAGNIFY);\r\n                    }\r\n\r\n                    // Draw flat or sharp symbol if appropriate\r\n                    const x2 = (x - 13 * MAGNIFY);\r\n                    const y = (44 + scale * 8 + bounceDelta) * MAGNIFY;\r\n                    if ((bNote & 0x80) != 0) {\r\n                        this.L2C.drawImage(IMAGES.Semitone[0], x2, y);\r\n                    } else if ((bNote & 0x40) != 0) {\r\n                        this.L2C.drawImage(IMAGES.Semitone[1], x2, y);\r\n                    }\r\n                }\r\n            }\r\n\r\n            // Draw red placeholder / cursor when in edit mode and hovering grid position\r\n            if (this.appState.gameStatus == GameStatus.Edit && gridX && gridY) {\r\n                this.L2C.beginPath();\r\n                this.L2C.setLineDash([7 * MAGNIFY, 2 * MAGNIFY, 7 * MAGNIFY, 0]);\r\n                this.L2C.lineWidth = MAGNIFY;\r\n                this.L2C.strokeStyle = '#F00';\r\n                const xorg = (16 + 32 * gridX - 8);\r\n                const x = xorg * MAGNIFY;\r\n                const y = (40 + gridY * 8) * MAGNIFY;\r\n                this.L2C.rect(x, y, CHARSIZE, CHARSIZE);\r\n                this.L2C.stroke();\r\n            }\r\n            this.L2C.restore();\r\n        }\r\n    }\r\n\r\n    private _drawHorizontalBar(gridX: number, scroll: number) {\r\n        const { HALFCHARSIZE, MAGNIFY } = this.CONST;\r\n        // X is the x of vertical bar (in grid)\r\n        const width = 24 * MAGNIFY;\r\n        this.L2C?.fillRect((4 + 32 * gridX - scroll) * MAGNIFY,\r\n            (38 + 11 * 8) * MAGNIFY + HALFCHARSIZE,\r\n            width, 2 * MAGNIFY);\r\n    }\r\n\r\n    private _drawRepeatHead(x: number) {\r\n        const { MAGNIFY } = this.CONST;\r\n        const { IMAGES } = this.ASSETS;\r\n        if (this.L2C && IMAGES) {\r\n            const w = IMAGES.Repeat[0].width;\r\n            const h = IMAGES.Repeat[0].height;\r\n            this.L2C.drawImage(IMAGES.Repeat[0], x * MAGNIFY, 56 * MAGNIFY);\r\n        }\r\n    }\r\n\r\n    public drawEndMarkIcon(img: HTMLImageElement) {\r\n        const { MAGNIFY } = this.CONST;\r\n        if (this.L1C) {\r\n            this.L1C.clearRect(4 * MAGNIFY, 8 * MAGNIFY, 16 * MAGNIFY, 14 * MAGNIFY);\r\n            this.L1C.drawImage(img, 5 * MAGNIFY, 8 * MAGNIFY);\r\n        }\r\n    }\r\n\r\n    private _drawBarNumber(gridX: number, barnum: number) {\r\n        const { MAGNIFY } = this.CONST;\r\n        const { IMAGES } = this.ASSETS;\r\n        if (IMAGES && this.L2C) {\r\n            let x = (16 + 32 * gridX) * MAGNIFY - 1;\r\n            const y = (40 - 7) * MAGNIFY;\r\n            const nums = [];\r\n            while (barnum > 0) {\r\n                nums.push(barnum % 10);\r\n                barnum = Math.floor(barnum / 10);\r\n            }\r\n            const len = nums.length;\r\n            if (len == 1) x += 2 * MAGNIFY;\r\n            while (nums.length > 0) {\r\n                const n = nums.pop();\r\n                if (n !== undefined) {\r\n                    const width = (n == 4) ? 5 : 4;\r\n                    this.L2C.drawImage(IMAGES.Numbers[n], x, y, 5 * MAGNIFY, 7 * MAGNIFY);\r\n                    x += width * MAGNIFY;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    public drawEraserIcon() {\r\n        const { MAGNIFY } = this.CONST;\r\n        if (this.L1C) this.L1C.clearRect(4 * MAGNIFY, 8 * MAGNIFY, 16 * MAGNIFY, 14 * MAGNIFY);\r\n    }\r\n\r\n    public drawMario(marioImage: HTMLImageElement, x: number, y: number) {\r\n        const { MAGNIFY } = this.CONST;\r\n        const sequencer = this;\r\n        if (this.L2C) {\r\n            this.L2C.drawImage(marioImage, x * MAGNIFY, y * MAGNIFY);\r\n        }\r\n    }\r\n\r\n    public drawMarioSweat(marioImage: HTMLImageElement,\r\n        sx: number, sy: number, sw: number, sh: number,\r\n        dx: number, dy: number, dw: number, dh: number\r\n    ) {\r\n        const { MAGNIFY } = this.CONST;\r\n        if (this.L2C) {\r\n            this.L2C.drawImage(\r\n                marioImage,\r\n                sx, sy, sw, sh,\r\n                dx * MAGNIFY, dy * MAGNIFY,\r\n                dw * MAGNIFY, dh * MAGNIFY\r\n            );\r\n        }\r\n    }\r\n\r\n    //#endregion\r\n\r\n    //#region mario state / animation functions\r\n\r\n    private _autoPlayIfDemanded(opts: any) {\r\n        let auto = opts['a'] || opts['auto'];\r\n        if (auto != undefined) {\r\n            auto = auto.toUpperCase();\r\n            if (auto == \"T\" || auto == \"TRUE\") {\r\n                const playBtn = document.getElementById(\"play\") as HTMLButtonElement;\r\n                if (playBtn) playBtn.dispatchEvent(new Event(\"click\"));\r\n            }\r\n        }\r\n    }\r\n\r\n    public doMarioEnter(timeStamp: number) {\r\n        this.TIMERS.bomb.checkAndFire(timeStamp);\r\n        this.drawScore(0, this.appState.curScore.notes, 0);\r\n        if (this.mario) {\r\n            this.mario.enter(timeStamp);\r\n\r\n            if (this.mario.x < 40) {\r\n                this.appState.animeId = window.requestAnimFrame(this.doMarioEnter);\r\n            } else {\r\n                this.mario.init4playing(timeStamp);\r\n                this.appState.gameStatus = GameStatus.Playing;\r\n                this.appState.animeId = window.requestAnimFrame(this.doMarioPlay);\r\n            }\r\n        }\r\n    }\r\n\r\n    public doMarioPlay(timeStamp: number) {\r\n        this.TIMERS.bomb.checkAndFire(timeStamp);\r\n        if (this.mario) {\r\n            this.mario.play(timeStamp);\r\n            if (this.appState.gameStatus == GameStatus.Playing) {\r\n                if (this.mario.pos - 2 != this.appState.curScore.end - 1) {\r\n                    this.appState.animeId = window.requestAnimFrame(this.doMarioPlay);\r\n                } else if (this.appState.curScore.loop) {\r\n                    this.appState.curPos = 0;\r\n                    this.mario.pos = 1;\r\n                    this.mario.x = 40;\r\n                    this.mario.init4playing(timeStamp);\r\n                    this.appState.animeId = window.requestAnimFrame(this.doMarioPlay);\r\n                } else {\r\n                    // Calls stopListener without a event arg\r\n                    const stopBtn = document.getElementById('stop') as SequencerButton;\r\n                    EmitClickEvent(stopBtn, true);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    public doMarioLeave(timeStamp: number) {\r\n        this.TIMERS.bomb.checkAndFire(timeStamp);\r\n        if (this.mario) {\r\n            this.drawScore(this.appState.curPos, this.appState.curScore.notes, this.mario.scroll);\r\n            this.mario.leave(timeStamp);\r\n\r\n            if (this.mario.x < 247) {\r\n                window.requestAnimFrame(this.doMarioLeave);\r\n            } else {\r\n                this.appState.gameStatus = GameStatus.Edit;\r\n\r\n                [\"toLeft\", \"toRight\", \"scroll\", \"play\", \"clear\", \"frog\", \"beak\", \"1up\"].\r\n                    map(function (id) {\r\n                        (document.getElementById(id) as HTMLButtonElement).disabled = false;\r\n                    });\r\n\r\n                window.requestAnimFrame(this.doAnimation);\r\n            }\r\n        }\r\n    }\r\n\r\n    public doAnimation(time: number) {\r\n        if (!this.appState.resizing) {\r\n            this.TIMERS.bomb?.checkAndFire(time);\r\n            this.TIMERS.eraser?.checkAndFire(time);\r\n            this.TIMERS.endMark?.checkAndFire(time);\r\n\r\n            this.drawScore(this.appState.curPos, this.appState.curScore['notes'], 0);\r\n\r\n            if (this.appState.gameStatus != GameStatus.Edit) return;\r\n        }\r\n\r\n        window.requestAnimFrame(this.doAnimation);\r\n    }\r\n\r\n    public scheduleAndPlay(notes: (string | number)[], time: number) {\r\n        const { SOUNDS } = this.ASSETS;\r\n        if (time < 0) time = 0;\r\n        if (notes == undefined || notes.length == 0) return;\r\n        const dic: Record<number, number[]> = {};\r\n        for (let i = 0; i < notes.length; i++) {\r\n            const note = notes[i];\r\n\r\n            // Dynamic tempo change\r\n            if (typeof note == \"string\") {\r\n                const tempo = note.split(\"=\")[1];\r\n                this.appState.curScore.tempo = tempo;\r\n                const tempoEl = document.getElementById(\"tempo\") as HTMLInputElement;\r\n                if (tempoEl) tempoEl.value = tempo;\r\n                continue;\r\n            }\r\n\r\n            const num = note >> 8;\r\n            const scale = note & 0xFF;\r\n            if (!dic[num]) dic[num] = [scale];\r\n            else dic[num].push(scale);\r\n        }\r\n        for (let i in dic) {\r\n            SOUNDS[i].playChord(dic[i], time / 1000); // [ms] -> [s]\r\n        }\r\n    }\r\n\r\n    //#endregion\r\n\r\n    //#region button image util functions\r\n\r\n    public resizeDOM(b: SequencerButton | SequencerSlider, w: number, h: number) {\r\n        const { MAGNIFY } = this.CONST;\r\n        b.style.width = w * MAGNIFY + \"px\";\r\n        b.style.height = h * MAGNIFY + \"px\";\r\n    }\r\n\r\n    public moveDOM(b: SequencerButton | SequencerSlider, x: number, y: number) {\r\n        const { MAGNIFY } = this.CONST;\r\n        b.style.left = x * MAGNIFY + \"px\";\r\n        b.style.top = y * MAGNIFY + \"px\";\r\n    }\r\n\r\n    private async _resizeScreen(magIdx: number) {\r\n        let { CHARSIZE, HALFCHARSIZE, MAGNIFY, ORGWIDTH, ORGHEIGHT, OFFSETLEFT, OFFSETTOP, SCRHEIGHT } = this.CONST;\r\n        this.appState.resizing = true;\r\n\r\n        const clearCanvas = () => {\r\n            if (this.L1C) {\r\n                this.L1C.clearRect(0, 0, ORGWIDTH * MAGNIFY, ORGHEIGHT * MAGNIFY);\r\n            }\r\n            if (this.L2C) {\r\n                this.L2C.clearRect(0, 0, ORGWIDTH * MAGNIFY, SCRHEIGHT * MAGNIFY);\r\n            }\r\n        };\r\n\r\n        let newMagnify = magIdx;\r\n        const scaledMagnify = Utils.getScaledMagnify();\r\n        if (magIdx > 3) {\r\n            newMagnify = scaledMagnify;\r\n        }\r\n        MAGNIFY = newMagnify;\r\n        CHARSIZE = 16 * MAGNIFY;\r\n        HALFCHARSIZE = Math.floor(CHARSIZE / 2);\r\n\r\n        this.container.style.width = ORGWIDTH * MAGNIFY + \"px\";\r\n        this.container.style.height = ORGHEIGHT * MAGNIFY + \"px\";\r\n        this.container.style.setProperty('--scaledMagnify', magIdx > 3 ? scaledMagnify.toString() : \"0\");\r\n        OFFSETLEFT = this.container.offsetLeft;\r\n        OFFSETTOP = this.container.offsetTop;\r\n\r\n        if (this.container) {\r\n            this.container.classList.remove(styles.mag1x, styles.mag2x, styles.mag3x);\r\n            switch (newMagnify) {\r\n                case 1:\r\n                    this.container.classList.add(styles.mag1x);\r\n                    break;\r\n                case 2:\r\n                    this.container.classList.add(styles.mag2x);\r\n                    break;\r\n                case 3:\r\n                    this.container.classList.add(styles.mag3x);\r\n                    break;\r\n            }\r\n        }\r\n\r\n        clearCanvas();\r\n\r\n        this.CONST = {\r\n            ...this.CONST,\r\n            CHARSIZE,\r\n            HALFCHARSIZE,\r\n            MAGNIFY,\r\n            OFFSETLEFT,\r\n            OFFSETTOP\r\n        };\r\n\r\n        await new UI.Loader(this).init(true);\r\n        this.container.querySelectorAll('button.game, input[type=\"range\"]').forEach((element) => {\r\n            (element as SequencerButton | SequencerSlider).redraw();\r\n        });\r\n        this.ui.changeCursor(this.appState.currentTool);\r\n\r\n        this.appState.resizing = false;\r\n    }\r\n\r\n    //#endregion\r\n\r\n    //#region file handling \r\n\r\n    private _downloadJSON() {\r\n        const link = document.createElement(\"a\");\r\n        link.download = 'MSQ_Data.json';\r\n        const json = JSON.stringify(this.appState.curScore);\r\n        const blob = new Blob([json], { type: \"octet/stream\" });\r\n        const url = window.URL.createObjectURL(blob);\r\n        link.href = url;\r\n        link.click();\r\n    }\r\n\r\n    private _downloadMP3() {\r\n        const downloadOpts = document.querySelector('.downloadOpts') as HTMLDivElement;\r\n        downloadOpts.classList.remove(\"rendering\", \"dlReady\");\r\n        songToAudio(this).then((song) => {\r\n            const e = new Event(\"mp3update\") as Mp3UpdateEvent;\r\n            e.data = {\r\n                type: \"song\",\r\n                value: song\r\n            };\r\n            this.container.dispatchEvent(e);\r\n        });\r\n\r\n        // songToAudio(this.ASSETS.SOUNDS, Number(this.appState.curScore.tempo), this.appState.curScore);\r\n    }\r\n\r\n    private _onMp3Update(ev: Mp3UpdateEvent) {\r\n        const downloadOpts = document.querySelector('.downloadOpts') as HTMLDivElement;\r\n        const progressBar = document.querySelector('progress') as HTMLProgressElement;\r\n        switch (ev.data.type) {\r\n            case \"chordGenUpdate\":\r\n            case \"songProgressUpdate\":\r\n                if (!downloadOpts.classList.contains(\"rendering\"))\r\n                    downloadOpts.classList.add(\"rendering\");\r\n                progressBar.value = ev.data.value * 100;\r\n                break;\r\n            case \"song\":\r\n                if (!downloadOpts.classList.contains(\"dlReady\")) {\r\n                    downloadOpts.classList.remove(\"rendering\");\r\n                    downloadOpts.classList.add(\"dlReady\");\r\n                }\r\n                // Check if audio element with id 'export' exists\r\n                let audioEl = downloadOpts.querySelector('#export') as HTMLAudioElement;\r\n\r\n                if (!audioEl) {\r\n                    // If it doesn't exist, create a new one and append it to the body\r\n                    audioEl = document.createElement('audio');\r\n                    audioEl.id = 'export';\r\n                    audioEl.controls = true;\r\n                    downloadOpts.appendChild(audioEl);\r\n                }\r\n\r\n                // Set the src attribute to the blob URL\r\n                audioEl.src = ev.data.value;\r\n                break;\r\n        }\r\n    }\r\n\r\n    //#endregion\r\n\r\n    public setState(stateUpdate: Partial<MarioSequencerAppState>) {\r\n        this.updateHistory();\r\n        this.appState = Object.assign(this.appState, stateUpdate);\r\n    }\r\n}\r\n\r\nnew MarioSequencer('#app');"],"names":["leafPrototypes","getProto","inProgress","dataWebpackPrefix","map","webpackContext","req","id","webpackContextResolve","__webpack_require__","o","e","Error","code","keys","Object","resolve","module","exports","__webpack_module_cache__","moduleId","cachedModule","undefined","__webpack_modules__","m","getPrototypeOf","obj","t","value","mode","this","__esModule","then","ns","create","r","def","current","indexOf","getOwnPropertyNames","forEach","key","d","definition","defineProperty","enumerable","get","f","chunkId","Promise","all","reduce","promises","u","miniCssF","g","globalThis","Function","window","prop","prototype","hasOwnProperty","call","l","url","done","push","script","needAttach","scripts","document","getElementsByTagName","i","length","s","getAttribute","createElement","charset","timeout","nc","setAttribute","src","onScriptComplete","prev","event","onerror","onload","clearTimeout","doneFns","parentNode","removeChild","fn","setTimeout","bind","type","target","head","appendChild","Symbol","toStringTag","scriptUrl","importScripts","location","currentScript","replace","p","installedChunks","j","installedChunkData","promise","reject","error","errorType","realSrc","message","name","request","webpackJsonpCallback","parentChunkLoadingFunction","data","chunkIds","moreModules","runtime","some","chunkLoadingGlobal","self","GameStatus","SoundEntity","constructor","app","settings","path","image","AC","buffer","prevChord","diff","play","scale","delay","source","createBufferSource","tmps","semitone","playbackRate","Math","pow","SEMITONERATIO","connect","destination","MSDestination","start","playChord","noteList","stop","load","filepath","XMLHttpRequest","open","responseType","decodeAudioData","response","send","SoundManager","sequencer","_sequencer","loadSounds","SOUNDS","ASSETS","tmp","toString","file","slice","CONST","frequency","func","images","_lastTime","switch","currentFrame","_frequency","_func","checkAndFire","time","Mario","sequencerInstance","offset","scroll","x","sweatImage","spriteImages","pos","state","isJumping","lastTime","IMAGES","Sweat","init","mario","timer","enter","timeStamp","floor","draw","init4leaving","init4playing","_checkMarioShouldJump","notes","appState","curScore","tempo","step","getElementById","nextBar","curPos","scheduleAndPlay","end","drawScore","_jump","round","y","drawMario","leave","w","width","h","height","drawMarioSweat","EmbeddedSongs","EmitClickEvent","b","soundOff","Event","dispatchEvent","Utils","boundFn","getConstants","opts","container","MAGNIFY","mag","magnify","getScaledMagnify","CHARSIZE","HALFCHARSIZE","style","DEFAULTMAXBARS","DEFAULTTEMPO","ORGHEIGHT","ORGWIDTH","SCRHEIGHT","OFFSETLEFT","offsetLeft","OFFSETTOP","offsetTop","innerWidth","innerHeight","min","createButton","args","className","clickHandler","position","moveDOM","resizeDOM","zIndex","background","originalX","originalY","originalW","originalH","setCurrentFrame","num","backgroundImage","redraw","addEventListener","classList","add","createChoiceGroupFunction","buttons","callbackFn","clone","splice","otherButtons","disabled","showSpriteFrame","btn","frameLength","getImageElFromPath","Image","sliceImage","img","result","charw","charh","tmpcan","tmpctx","getContext","imageSmoothingEnabled","drawImage","charimg","toDataURL","JSON","parse","stringify","UI","Loader","_onMouse","_onMouseMove","_sliceImage","_createButton","_createChoiceGroupFunction","reInit","_initLayers","_initImageAssets","_initBomb","_initInstrumentButtons","_initEndMarkButton","_initPlayButton","_initStopButton","_initLoopButton","_initScrollRange","_initBeatButtons","_initSongButtons","_initUndoDog","_initEraserButton","_initTempoRange","_initClearButton","initMusicScore","_initScreen","_initKeyboardEventListeners","_initMouseEvents","layer1","querySelector","layer2","Layer1","Layer2","L1C","L2C","bg","_loadSpritesheets","Chars","Bomb","End","PlayBtn","Repeat","Semitone","Numbers","Stop","Beat","Song","ThumbSlider","ClearBtn","UndoDog","SPRITESHEETS","skipLoading","ss","repeatMarks","Tools","GClef","StopBtn","BeatBtn","SongBtns","EndMarkBtn","EndMark","TIMERS","bomb","selectedSongBtn","gameStatus","Playing","ui","BUTTONS","bimgs","_getOrCreateButton","se","setState","currentTool","_clearEraserButton","changeCursor","_drawCurChar","endMark","drawEndMarkIcon","cursor","bubbles","imgs","loop","reset","set","max","curMaxBars","margin","parseInt","deltaY","valueAsNumber","cancelable","preventDefault","stopPropagation","b1","beats","b2","songButtons","idx","callbackFunc","tempoEl","scr","Edit","frame","previousState","history","pop","changeSongBtn","changeBeat","isSelected","eraser","drawEraserIcon","_clearSongButtons","setThumbImage","range","seqEl","setProperty","val","_reInitButtonsFromScore","tempoRange","substr","split","requestAnimFrame","doAnimation","_readDroppedFiles","SCREEN","beginPath","clearRect","fillRect","click","realX","clientX","realY","clientY","toGrid","gridX","gridY","updateHistory","allNotes","button","note","shiftKey","ctrlKey","mouseX","mouseY","resetScore","dataTransfer","files","sort","a","n1","n2","strip","n","exec","parseFloat","reader","FileReader","readAsText","chain","fp","fileReader","addMSQ","addJSON","catch","err","alert","console","keyPresses","filter","k","isShifting","canvasRecorder","save","playBtn","stopBtn","cancelAnimationFrame","animeId","doMarioEnter","gridLeft","gridTop","getChordBuffer","chords","nextChords","lengthInSecs","beatCount","totalBeats","sounds","reduceNotes","chordObj","cur","arr","nextNotes","restrictLength","instrumentNums","longestSound","buffers","instrumentBuffer","duration","context","OfflineAudioContext","ev","evt","semitoneRatio","instrumentNum","startRendering","convertFloat32ToInt16","int16Buffer","Int16Array","intVal","audioBufferToMp3","audioBuffer","mp3Encoder","Mp3Encoder","numberOfChannels","sampleRate","samples","getChannelData","sampleBlockSize","mp3Data","left","subarray","right","mp3Block","encodeBuffer","mp3Blob","Blob","CanvasRecorder","canvas","video_bits_per_sec","recordedBlobs","mediaRecorder","handleDataAvailable","handleStop","_app","_vbps","video","display","stream","captureStream","createMediaStreamDestination","types","MediaRecorder","isTypeSupported","supportedType","log","options","mimeType","videoBitsPerSecond","audioBitsPerSecond","mediaStream","MediaStream","addTrack","getVideoTracks","getAudioTracks","onstop","ondataavailable","controls","filename","blob","URL","createObjectURL","href","download","body","revokeObjectURL","size","superBuffer","requireAll","navigator","serviceWorker","register","registration","registrationError","requestAnimationFrame","webkitRequestAnimationFrame","mozRequestAnimationFrame","oRequestAnimationFrame","msRequestAnimationFrame","callback","containerSelector","AudioContext","webkitAudioContext","resizing","_urlOptions","_maxHistory","doMarioLeave","doMarioPlay","_downloadJSON","_downloadMP3","soundManager","containerEl","initialMagnify","_onMp3Update","search","selectedIndex","_resizeScreen","select","magIdx","downloadJSONBtn","downloadMP3Btn","backBtn","remove","checked","port","urlVal","protocol","hostname","pathname","bars","bar","tone","Array","setSelectionRange","clipboard","writeText","MarioEntering","MarioLeaving","AddEvents","spinner","_actionUrlParams","OPTS","status","statusText","_autoPlayIfDemanded","stack","S","SCORE","score","TEMPO","T","LOOP","L","END","E","TIME44","B","toUpperCase","text","tmpa","tempoInput","beatBtn","lines","keyword","values","line","kv","v","oldEnd","count","out","json","rect","clip","_drawHorizontalBar","_drawRepeatHead","orange","xorg","barnum","setLineDash","lineWidth","_drawBarNumber","strokeStyle","moveTo","lineTo","stroke","bounceDelta","hflag","bNote","sndnum","soundImage","x2","restore","nums","marioImage","sx","sy","sw","sh","dx","dy","dw","dh","auto","dic","top","newMagnify","scaledMagnify","clearCanvas","querySelectorAll","element","link","song","seconds","Number","singleBeatSeconds","suspend","onstatechange","currentTime","resume","oncomplete","beat","beatNotes","beatChords","noteValue","beatToInstrumentChords","beatBuffer","songBuffer","songToAudio","downloadOpts","progressBar","contains","audioEl","stateUpdate","assign"],"sourceRoot":""}